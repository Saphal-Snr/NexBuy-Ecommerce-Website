<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Portal - Professional Learning Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--dark);
            color: white;
            position: fixed;
            height: 100vh;
            transition: all 0.3s;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid #343a40;
            text-align: center;
        }

        .sidebar-header .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .sidebar-header .logo-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }

        .nav-links {
            padding: 1.5rem 0;
        }

        .nav-item {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            color: #adb5bd;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover, .nav-item.active {
            background: #343a40;
            color: white;
            border-left-color: var(--primary);
        }

        .nav-item i {
            margin-right: 1rem;
            font-size: 1.2rem;
            width: 20px;    
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            background: #f8f9fa;
            min-height: 100vh;
        }

        /* Top Navigation */
        .top-nav {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
        }

        /* Content Area */
        .content {
            padding: 2rem;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            border: none;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f3f4;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
            margin: 0;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Material Items */
        .material-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        }

        .material-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
        }

        .material-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .material-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .material-description {
            color: #6c757d;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .material-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
        }

        .material-department {
            background: var(--info);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .material-semester {
            background: var(--success);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit {
            background: var(--info);
            color: white;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        /* Buttons */
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-map {
            background: #34a853;
            color: white;
        }

        .btn-map:hover {
            background: #2e8b47;
            transform: translateY(-2px);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        /* Print Service Styles */
        .print-service-box {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .print-service-box h2 {
            margin-bottom: 1.5rem;
            color: var(--dark);
            text-align: center;
        }

        .print-service-box input, .print-service-box select, .print-service-box button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
        }

        .print-service-box button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .print-service-box button:hover {
            background: var(--secondary);
        }

        .amount-display {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
            margin: 1rem 0;
            color: var(--dark);
        }

        /* QR Code Styles */
        .qr-container {
            text-align: center;
            margin: 2rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px dashed #dee2e6;
        }

        .qr-code {
            display: inline-block;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .payment-instructions {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
        }

        .payment-instructions h4 {
            color: #2e7d32;
            margin-bottom: 0.5rem;
        }

        .file-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .file-info h4 {
            color: #1565c0;
            margin-bottom: 0.5rem;
        }

        .price-breakdown {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .price-breakdown h4 {
            color: #e65100;
            margin-bottom: 0.5rem;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
            padding: 0.3rem 0;
            border-bottom: 1px dashed #ffe0b2;
        }

        .price-total {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #ff9800;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* New styles for enhanced print service */
        .print-service-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .print-icon-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.8rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 180px;
        }
        
        .print-icon-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .print-icon-item i {
            font-size: 1rem;
            color: var(--primary);
            width: 20px;
            text-align: center;
        }
        
        .print-icon-item .icon-text {
            flex: 1;
            font-size: 0.85rem;
            color: #495057;
        }
        
        .print-icon-item .icon-value {
            font-weight: 600;
            color: var(--dark);
            word-break: break-all;
        }
        
        .print-info-section {
            background: #e8f4fd;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid #b8daff;
        }
        
        .print-info-section h4 {
            color: #0d6efd;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .print-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .print-info-item {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }
        
        .print-info-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }
        
        .print-info-value {
            color: var(--dark);
            font-weight: 500;
            word-break: break-word;
        }
        
        .upload-status {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            font-weight: 600;
        }
        
        .upload-status.success {
            background: #d1edff;
            border: 1px solid #b6d7ff;
            color: #0d6efd;
        }
        
        .upload-status.error {
            background: #f8d7da;
            border: 1px solid #f1aeb5;
            color: #721c24;
        }
        
        .file-preview {
            max-width: 100%;
            margin: 1rem 0;
            text-align: center;
        }
        
        .file-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* NEW STYLES FOR ENHANCED FEATURES */
        .paste-box-container {
            display: flex;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }
        
        .paste-box {
            flex: 1;
            padding: 0.6rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: #f8f9fa;
            font-size: 0.85rem;
            min-height: 38px;
            display: flex;
            align-items: center;
            word-break: break-all;
        }
        
        .paste-box.empty {
            color: #6c757d;
            font-style: italic;
        }
        
        .paste-btn {
            padding: 0.6rem 0.8rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .paste-btn:hover {
            background: var(--secondary);
        }
        
        .validation-status {
            margin-top: 0.3rem;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .validation-status.valid {
            color: #28a745;
        }
        
        .validation-status.invalid {
            color: #dc3545;
        }
        
        .enhanced-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: flex-end;
        }
        
        .enhanced-actions .btn {
            padding: 0.6rem 1.2rem;
            font-size: 0.85rem;
        }
        
        .xerox-admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .xerox-stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        
        .xerox-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .xerox-stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .order-status-select {
            padding: 0.5rem;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            font-size: 0.9rem;
            background: white;
        }
        
        .order-status-select.pending { background: #fff3cd; }
        .order-status-select.paid { background: #d1ecf1; }
        .order-status-select.printed { background: #d4edda; }
        .order-status-select.completed { background: #d1ecf1; }
        .order-status-select.cancelled { background: #f8d7da; }

        /* NEW: Input fields for icons */
        .icon-input-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .icon-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .icon-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .icon-input-btn {
            padding: 0.5rem 0.8rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* NEW: Manual Transaction ID Input */
        .manual-transaction-section {
            background: #fff8e1;
            border: 1px solid #ffd54f;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .manual-transaction-section h4 {
            color: #ff8f00;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Auth Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
        }

        .auth-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .auth-subtitle {
            color: #6c757d;
            font-size: 1rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            color: white;
            z-index: 1050;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .notification.success { background: var(--success); }
        .notification.error { background: var(--danger); }
        .notification.info { background: var(--info); }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: #6c757d;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Classroom and Office Cards */
        .location-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        }

        .location-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
        }

        .location-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .location-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .location-type {
            background: var(--warning);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .location-description {
            color: #6c757d;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .location-details {
            margin-bottom: 1rem;
        }

        .detail-item {
            display: flex;
            margin-bottom: 0.5rem;
        }

        .detail-label {
            font-weight: 600;
            width: 120px;
            color: var(--dark);
        }

        .detail-value {
            flex: 1;
            color: #6c757d;
        }

        /* Search and Filter */
        .search-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .search-input {
            flex: 1;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .filter-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 0.8rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            min-width: 150px;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        /* Print Shop Admin Styles */
        .order-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
            margin-bottom: 1.5rem;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .order-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
        }

        .order-status {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-paid { background: #d1ecf1; color: #0c5460; }
        .status-printed { background: #d4edda; color: #155724; }
        .status-completed { background: #d1ecf1; color: #0c5460; }
        .status-cancelled { background: #f8d7da; color: #721c24; }

        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .order-detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.3rem;
        }

        .detail-value {
            color: #6c757d;
        }

        .order-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Receipt Upload Styles */
        .receipt-upload {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            margin: 1rem 0;
        }

        .receipt-upload p {
            margin-bottom: 1rem;
            color: #6c757d;
        }

        /* File Upload Area */
        .file-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s;
            background: #fafafa;
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background-color: #f8f9fa;
        }

        .file-upload-area.dragover {
            border-color: var(--primary);
            background-color: #e3f2fd;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .material-grid, .location-grid {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .search-box {
                flex-direction: column;
            }
            .filter-options {
                flex-direction: column;
            }
            .order-details {
                grid-template-columns: 1fr;
            }
            .print-service-icons {
                flex-direction: column;
            }
            .print-icon-item {
                min-width: 100%;
            }
            .paste-box-container {
                flex-direction: column;
            }
            .xerox-admin-stats {
                grid-template-columns: 1fr;
            }
            .icon-input-group {
                flex-direction: column;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-3 { margin-top: 1rem; }
        .mb-3 { margin-bottom: 1rem; }
        .d-flex { display: flex; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }

        /* Drive Badge */
        .drive-badge {
            background: #4285f4;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* Map Badge */
        .map-badge {
            background: #34a853;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            cursor: pointer;
            text-decoration: none;
        }

        .map-badge:hover {
            background: #2e8b47;
            color: white;
        }
        
        /* Department Badge */
        .department-badge {
            background: #9c27b0;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading" id="loadingScreen">
            <div class="spinner"></div>
            <div>Loading Campus Portal...</div>
        </div>
    </div>

    <script>
        // =============================================
        // FIREBASE CONFIGURATION
        // =============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBlu_U2XprHRyMZipTDfqVHEPt7N_MBUS0",
            authDomain: "hamarocampus.firebaseapp.com",
            databaseURL: "https://hamarocampus-default-rtdb.firebaseio.com",
            projectId: "hamarocampus",
            storageBucket: "hamarocampus.firebasestorage.app",
            messagingSenderId: "469119628515",
            appId: "1:469119628515:web:6fdb446799b9ae141ac1d6",
            measurementId: "G-40KDX4S676"
        };

        // =============================================
        // FIREBASE INITIALIZATION
        // =============================================
        let auth, database, storage;
        let firebaseInitialized = false;

        function initializeFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                auth = firebase.auth();
                database = firebase.database();
                storage = firebase.storage();
                firebaseInitialized = true;
                console.log("‚úÖ Firebase initialized successfully");
                return true;
            } catch (error) {
                console.error("‚ùå Firebase initialization error:", error);
                Utils.showNotification("Firebase configuration error. Please check your settings.", "error");
                return false;
            }
        }

        // Initialize Firebase immediately
        initializeFirebase();

        // =============================================
        // GLOBAL VARIABLES
        // =============================================
        let authSystem, dbManager, studentDashboard, facultyDashboard, adminDashboard, xeroxAdminDashboard;

        // =============================================
        // UTILITY FUNCTIONS
        // =============================================
        class Utils {
            static showElement(id) {
                const element = document.getElementById(id);
                if (element) element.classList.remove('hidden');
            }

            static hideElement(id) {
                const element = document.getElementById(id);
                if (element) element.classList.add('hidden');
            }

            static showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="d-flex align-center gap-2">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 4000);
            }

            static formatDate(timestamp) {
                if (!timestamp) return 'Unknown date';
                return new Date(timestamp).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            static validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            static getInitials(name) {
                return name ? name.split(' ').map(n => n[0]).join('').toUpperCase() : 'U';
            }

            static async copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    this.showNotification('Copied to clipboard!', 'success');
                } catch (error) {
                    this.showNotification('Failed to copy', 'error');
                }
            }

            static openGoogleMaps(location) {
                if (!location) return;
                const encodedLocation = encodeURIComponent(location);
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodedLocation}`, '_blank');
            }

            // PDF Page Counting Function
            static async getPDFPageCount(file) {
                return new Promise((resolve, reject) => {
                    if (!file || file.type !== 'application/pdf') {
                        reject(new Error('Please select a valid PDF file'));
                        return;
                    }

                    const fileReader = new FileReader();
                    
                    fileReader.onload = function() {
                        const typedarray = new Uint8Array(this.result);
                        
                        // Set up PDF.js
                        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
                        
                        pdfjsLib.getDocument(typedarray).promise.then(function(pdf) {
                            resolve(pdf.numPages);
                        }).catch(function(error) {
                            reject(new Error('Error reading PDF: ' + error.message));
                        });
                    };
                    
                    fileReader.onerror = function() {
                        reject(new Error('Error reading file'));
                    };
                    
                    fileReader.readAsArrayBuffer(file);
                });
            }

            // Generate QR Code
            static generateQRCode(elementId, text, size = 200) {
                const container = document.getElementById(elementId);
                if (!container) return null;
                
                // Clear previous QR code
                container.innerHTML = '';
                
                try {
                    const qrcode = new QRCode(container, {
                        text: text,
                        width: size,
                        height: size,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    return qrcode;
                } catch (error) {
                    console.error('QR Code generation error:', error);
                    container.innerHTML = '<p>QR Code generation failed. Please try again.</p>';
                    return null;
                }
            }

            // Validate WhatsApp Number
            static validateWhatsAppNumber(number) {
                // Basic validation for Indian numbers
                const re = /^[6-9]\d{9}$/;
                return re.test(number.replace(/\D/g, ''));
            }

            // Validate Secret Key
            static validateSecretKey(role, key) {
                const secretKeys = {
                    'student': 'sonastudent',
                    'faculty': 'sona@faculty100',
                    'admin': 'sona-admin@',
                    'xeroxadmin': 'sona@xerox69'
                };
                return secretKeys[role] === key;
            }

            // Validate Google Drive Link
            static validateGoogleDriveLink(link) {
                return link && link.includes('drive.google.com');
            }

            // Generate Transaction ID
            static generateTransactionId() {
                return "TXN" + Date.now();
            }

            // Calculate 24-hour statistics
            static calculate24HourStats(orders) {
                const now = new Date();
                const last24Hours = new Date(now.getTime() - (24 * 60 * 60 * 1000));
                
                const recentOrders = orders.filter(order => 
                    new Date(order.createdAt) >= last24Hours
                );
                
                const completedOrders = recentOrders.filter(order => 
                    order.status === 'completed'
                );
                
                const totalRevenue = completedOrders.reduce((sum, order) => 
                    sum + (parseFloat(order.amount) || 0), 0
                );
                
                return {
                    orderCount: recentOrders.length,
                    completedCount: completedOrders.length,
                    revenue: totalRevenue
                };
            }
        }

        // =============================================
        // AUTHENTICATION SYSTEM
        // =============================================
        class AuthSystem {
            constructor() {
                this.currentUser = null;
                this.userData = null;
                this.initAuthListener();
            }

            initAuthListener() {
                if (!auth) {
                    console.error("Auth not initialized");
                    return;
                }
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        this.currentUser = user;
                        await this.getUserData(user.uid);
                        App.showDashboard();
                    } else {
                        this.currentUser = null;
                        this.userData = null;
                        App.showAuthPage();
                    }
                });
            }

            async getUserData(uid) {
                try {
                    const snapshot = await database.ref('users/' + uid).once('value');
                    if (snapshot.exists()) {
                        this.userData = snapshot.val();
                    }
                } catch (error) {
                    console.error('Error getting user data:', error);
                }
            }

            async register(email, password, role, userData = {}) {
                try {
                    if (!Utils.validateEmail(email)) {
                        throw new Error('Please enter a valid email address');
                    }

                    if (password.length < 6) {
                        throw new Error('Password must be at least 6 characters long');
                    }

                    if (!userData.whatsappNumber) {
                        throw new Error('WhatsApp number is required');
                    }

                    if (!Utils.validateWhatsAppNumber(userData.whatsappNumber)) {
                        throw new Error('Please enter a valid WhatsApp number');
                    }

                    if (!userData.secretKey || !Utils.validateSecretKey(role, userData.secretKey)) {
                        throw new Error('Invalid secret key for the selected role');
                    }

                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;

                    await database.ref('users/' + user.uid).set({
                        email: email,
                        role: role,
                        fullName: userData.fullName || '',
                        department: userData.department || '',
                        whatsappNumber: userData.whatsappNumber,
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    });

                    Utils.showNotification('üéâ Registration successful! Welcome to Campus Portal.', 'success');
                    return true;
                } catch (error) {
                    console.error('Registration error:', error);
                    Utils.showNotification(error.message, 'error');
                    return false;
                }
            }

            async login(email, password, role = null, secretKey = null) {
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    const user = userCredential.user;

                    // Get user data to verify role
                    const snapshot = await database.ref('users/' + user.uid).once('value');
                    if (!snapshot.exists()) {
                        throw new Error('User data not found');
                    }

                    const userData = snapshot.val();
                    
                    // Check for secret keys for all roles
                    if (!Utils.validateSecretKey(userData.role, secretKey)) {
                        throw new Error('Invalid secret key for your role');
                    }

                    await database.ref('users/' + user.uid + '/lastLogin').set(new Date().toISOString());
                    Utils.showNotification('üëã Welcome back!', 'success');
                    return true;
                } catch (error) {
                    console.error('Login error:', error);
                    let errorMessage = 'Login failed. Please try again.';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No account found. Please register first.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Incorrect password. Please try again.';
                    } else if (error.message.includes('secret key')) {
                        errorMessage = error.message;
                    }
                    Utils.showNotification(errorMessage, 'error');
                    return false;
                }
            }

            async logout() {
                try {
                    await auth.signOut();
                    Utils.showNotification('üëã Logged out successfully', 'success');
                } catch (error) {
                    console.error('Logout error:', error);
                    Utils.showNotification(error.message, 'error');
                }
            }
        }

        // =============================================
        // DATABASE MANAGER
        // =============================================
        class DatabaseManager {
            async getStudentMaterials(department, semester = '') {
                try {
                    const snapshot = await database.ref('materials').orderByChild('department').equalTo(department).once('value');
                    const materials = [];
                    snapshot.forEach((childSnapshot) => {
                        const material = childSnapshot.val();
                        if (material.type === 'student') {
                            if (!semester || material.semester === semester) {
                                materials.push({ id: childSnapshot.key, ...material });
                            }
                        }
                    });
                    return materials;
                } catch (error) {
                    console.error('Error getting student materials:', error);
                    Utils.showNotification('Error loading materials', 'error');
                    return [];
                }
            }

            async getFacultyMaterials(department) {
                try {
                    const snapshot = await database.ref('materials').orderByChild('department').equalTo(department).once('value');
                    const materials = [];
                    snapshot.forEach((childSnapshot) => {
                        const material = childSnapshot.val();
                        if (material.createdBy === authSystem.currentUser.uid) {
                            materials.push({ id: childSnapshot.key, ...material });
                        }
                    });
                    return materials;
                } catch (error) {
                    console.error('Error getting faculty materials:', error);
                    Utils.showNotification('Error loading materials', 'error');
                    return [];
                }
            }

            async addMaterial(materialData) {
                try {
                    const newMaterialRef = database.ref('materials').push();
                    await newMaterialRef.set({
                        ...materialData,
                        createdAt: new Date().toISOString(),
                        createdBy: authSystem.currentUser.uid,
                        downloadCount: 0
                    });
                    
                    Utils.showNotification('üìö Material added successfully!', 'success');
                    return newMaterialRef.key;
                } catch (error) {
                    console.error('Error adding material:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return null;
                }
            }

            async updateMaterial(materialId, materialData) {
                try {
                    await database.ref('materials/' + materialId).update(materialData);
                    Utils.showNotification('üìö Material updated successfully!', 'success');
                    return true;
                } catch (error) {
                    console.error('Error updating material:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return false;
                }
            }

            async deleteMaterial(materialId) {
                try {
                    await database.ref('materials/' + materialId).remove();
                    Utils.showNotification('üóëÔ∏è Material deleted successfully!', 'success');
                    return true;
                } catch (error) {
                    console.error('Error deleting material:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return false;
                }
            }

            async incrementDownloadCount(materialId) {
                try {
                    const currentCount = await database.ref('materials/' + materialId + '/downloadCount').once('value');
                    const newCount = (currentCount.val() || 0) + 1;
                    await database.ref('materials/' + materialId + '/downloadCount').set(newCount);
                } catch (error) {
                    console.error('Error updating download count:', error);
                }
            }

            async addClassroom(classroomData) {
                try {
                    // Check if user is admin
                    if (authSystem.userData.role !== 'admin') {
                        throw new Error('Only administrators can add classrooms');
                    }

                    const newClassroomRef = database.ref('classrooms').push();
                    await newClassroomRef.set({
                        ...classroomData,
                        createdAt: new Date().toISOString(),
                        createdBy: authSystem.currentUser.uid
                    });
                    
                    Utils.showNotification('üè´ Classroom added successfully!', 'success');
                    return newClassroomRef.key;
                } catch (error) {
                    console.error('Error adding classroom:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return null;
                }
            }

            async updateClassroom(classroomId, classroomData) {
                try {
                    if (authSystem.userData.role !== 'admin') {
                        throw new Error('Only administrators can update classrooms');
                    }

                    await database.ref('classrooms/' + classroomId).update(classroomData);
                    Utils.showNotification('üè´ Classroom updated successfully!', 'success');
                    return true;
                } catch (error) {
                    console.error('Error updating classroom:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return false;
                }
            }

            async deleteClassroom(classroomId) {
                try {
                    if (authSystem.userData.role !== 'admin') {
                        throw new Error('Only administrators can delete classrooms');
                    }

                    await database.ref('classrooms/' + classroomId).remove();
                    Utils.showNotification('üóëÔ∏è Classroom deleted successfully!', 'success');
                    return true;
                } catch (error) {
                    console.error('Error deleting classroom:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return false;
                }
            }

            async getClassrooms() {
                try {
                    const snapshot = await database.ref('classrooms').once('value');
                    const classrooms = [];
                    snapshot.forEach((childSnapshot) => {
                        classrooms.push({ id: childSnapshot.key, ...childSnapshot.val() });
                    });
                    return classrooms;
                } catch (error) {
                    console.error('Error getting classrooms:', error);
                    Utils.showNotification('Error loading classrooms', 'error');
                    return [];
                }
            }

            async addFacultyOffice(officeData) {
                try {
                    // Check if user is admin
                    if (authSystem.userData.role !== 'admin') {
                        throw new Error('Only administrators can add faculty offices');
                    }

                    const newOfficeRef = database.ref('facultyOffices').push();
                    await newOfficeRef.set({
                        ...officeData,
                        createdAt: new Date().toISOString(),
                        createdBy: authSystem.currentUser.uid
                    });
                    
                    Utils.showNotification('üë®‚Äçüè´ Faculty office added successfully!', 'success');
                    return newOfficeRef.key;
                } catch (error) {
                    console.error('Error adding faculty office:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return null;
                }
            }

            async updateFacultyOffice(officeId, officeData) {
                try {
                    if (authSystem.userData.role !== 'admin') {
                        throw new Error('Only administrators can update faculty offices');
                    }

                    await database.ref('facultyOffices/' + officeId).update(officeData);
                    Utils.showNotification('üë®‚Äçüè´ Faculty office updated successfully!', 'success');
                    return true;
                } catch (error) {
                    console.error('Error updating faculty office:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return false;
                }
            }

            async deleteFacultyOffice(officeId) {
                try {
                    if (authSystem.userData.role !== 'admin') {
                        throw new Error('Only administrators can delete faculty offices');
                    }

                    await database.ref('facultyOffices/' + officeId).remove();
                    Utils.showNotification('üóëÔ∏è Faculty office deleted successfully!', 'success');
                    return true;
                } catch (error) {
                    console.error('Error deleting faculty office:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return false;
                }
            }

            async getFacultyOffices() {
                try {
                    const snapshot = await database.ref('facultyOffices').once('value');
                    const offices = [];
                    snapshot.forEach((childSnapshot) => {
                        offices.push({ id: childSnapshot.key, ...childSnapshot.val() });
                    });
                    return offices;
                } catch (error) {
                    console.error('Error getting faculty offices:', error);
                    Utils.showNotification('Error loading faculty offices', 'error');
                    return [];
                }
            }

            // Print Service Methods
            async addPrintOrder(orderData) {
                try {
                    console.log("üìù Adding print order to database:", orderData);
                    
                    const newOrderRef = database.ref('printOrders').push();
                    const orderId = newOrderRef.key;
                    
                    const completeOrderData = {
                        ...orderData,
                        id: orderId,
                        createdAt: new Date().toISOString(),
                        userId: authSystem.currentUser.uid,
                        status: 'pending',
                        receiptURL: '',
                        printedAt: null,
                        completedAt: null
                    };
                    
                    await newOrderRef.set(completeOrderData);
                    
                    console.log("‚úÖ Print order added successfully with ID:", orderId);
                    Utils.showNotification('üñ®Ô∏è Print order submitted successfully!', 'success');
                    return orderId;
                } catch (error) {
                    console.error('‚ùå Error adding print order:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return null;
                }
            }

            async updatePrintOrder(orderId, orderData) {
                try {
                    console.log("üîÑ Updating print order:", orderId, orderData);
                    await database.ref('printOrders/' + orderId).update(orderData);
                    Utils.showNotification('üñ®Ô∏è Print order updated successfully!', 'success');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error updating print order:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return false;
                }
            }

            async getPrintOrders(userId = null) {
                try {
                    console.log("üìã Fetching print orders for user:", userId);
                    
                    const snapshot = await database.ref('printOrders').once('value');
                    const orders = [];
                    
                    snapshot.forEach((childSnapshot) => {
                        const order = { 
                            id: childSnapshot.key, 
                            ...childSnapshot.val() 
                        };
                        
                        // If userId provided, filter by user, otherwise get all orders
                        if (!userId || order.userId === userId) {
                            orders.push(order);
                        }
                    });
                    
                    // Sort by creation date, newest first
                    const sortedOrders = orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    console.log(`‚úÖ Retrieved ${sortedOrders.length} orders`);
                    
                    return sortedOrders;
                } catch (error) {
                    console.error('‚ùå Error getting print orders:', error);
                    Utils.showNotification('Error loading print orders: ' + error.message, 'error');
                    return [];
                }
            }

            async uploadReceipt(orderId, file) {
                try {
                    console.log("üì§ Uploading receipt for order:", orderId);
                    const storageRef = storage.ref(`receipts/${orderId}_${Date.now()}_${file.name}`);
                    await storageRef.put(file);
                    const downloadURL = await storageRef.getDownloadURL();
                    console.log("‚úÖ Receipt uploaded successfully:", downloadURL);
                    return downloadURL;
                } catch (error) {
                    console.error('‚ùå Error uploading receipt:', error);
                    throw new Error('Failed to upload receipt: ' + error.message);
                }
            }

            // NEW: Delete print order
            async deletePrintOrder(orderId) {
                try {
                    console.log("üóëÔ∏è Deleting print order:", orderId);
                    await database.ref('printOrders/' + orderId).remove();
                    Utils.showNotification('üóëÔ∏è Print order deleted successfully!', 'success');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error deleting print order:', error);
                    Utils.showNotification('Error: ' + error.message, 'error');
                    return false;
                }
            }
        }

        // =============================================
        // ENHANCED STUDENT DASHBOARD WITH PRINT SERVICE ICONS
        // =============================================
        class StudentDashboard {
            constructor() {
                this.department = '';
                this.allClassrooms = [];
                this.allFacultyOffices = [];
                this.filteredClassrooms = [];
                this.filteredFacultyOffices = [];
                this.allMaterials = [];
                this.filteredMaterials = [];
                this.selectedFile = null;
                this.pdfPageCount = 0;
                this.myOrders = [];
                this.currentOrderId = null;
                this.fileInfo = {
                    fileName: '',
                    fileSize: '',
                    pageCount: 0,
                    googleDriveLink: '',
                    whatsappNumber: '',
                    transactionId: '',
                    manualTransactionId: '' // NEW: Manual transaction ID from payment receipt
                };
            }

            async init() {
                await this.getStudentDepartment();
                this.loadMaterials();
                await this.loadClassrooms();
                await this.loadFacultyOffices();
                await this.loadMyOrders();
                this.setupEventListeners();
            }

            async getStudentDepartment() {
                try {
                    const snapshot = await database.ref('users/' + authSystem.currentUser.uid).once('value');
                    this.department = snapshot.val().department || 'CSE';
                } catch (error) {
                    this.department = 'CSE';
                }
            }

            async loadMaterials(semester = '') {
                this.allMaterials = await dbManager.getStudentMaterials(this.department, semester);
                this.filteredMaterials = [...this.allMaterials];
                this.renderMaterials();
            }

            renderMaterials() {
                const container = document.getElementById('studentMaterials');
                if (!container) return;
                
                if (this.filteredMaterials.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 3rem; color: #6c757d;">
                            <i class="fas fa-folder-open" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Materials Available</h3>
                            <p>No study materials have been uploaded for your department and semester yet.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredMaterials.map(material => `
                    <div class="material-card">
                        <div class="material-header">
                            <div style="flex: 1;">
                                <h3 class="material-title">${material.title}</h3>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <span class="drive-badge">
                                        <i class="fab fa-google-drive"></i>
                                        Google Drive
                                    </span>
                                    ${material.semester ? `
                                        <span class="material-semester">
                                            <i class="fas fa-graduation-cap"></i>
                                            Semester ${material.semester}
                                        </span>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                        <p class="material-description">${material.description}</p>
                        <div class="material-meta">
                            <div>
                                <small style="color: #6c757d;">
                                    <i class="fas fa-calendar"></i>
                                    ${Utils.formatDate(material.createdAt)}
                                </small>
                                ${material.downloadCount ? `
                                    <small style="color: #28a745; margin-left: 1rem;">
                                        <i class="fas fa-download"></i>
                                        ${material.downloadCount} downloads
                                    </small>
                                ` : ''}
                            </div>
                            <button class="btn btn-primary" onclick="studentDashboard.downloadMaterial('${material.id}', '${material.fileURL}', '${material.fileName}')">
                                <i class="fas fa-download"></i>
                                Download
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            async downloadMaterial(materialId, fileUrl, fileName) {
                await dbManager.incrementDownloadCount(materialId);
                window.open(fileUrl, '_blank');
                Utils.showNotification('üì• Download started!', 'success');
            }

            async loadClassrooms() {
                this.allClassrooms = await dbManager.getClassrooms();
                this.filteredClassrooms = [...this.allClassrooms];
                this.renderClassrooms();
                this.updateBuildingFilter();
            }

            async loadFacultyOffices() {
                this.allFacultyOffices = await dbManager.getFacultyOffices();
                this.filteredFacultyOffices = [...this.allFacultyOffices];
                this.renderFacultyOffices();
            }

            async loadMyOrders() {
                this.myOrders = await dbManager.getPrintOrders(authSystem.currentUser.uid);
                this.renderMyOrders();
            }

            renderMyOrders() {
                const container = document.getElementById('myOrdersList');
                if (!container) return;
                
                if (this.myOrders.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 3rem; color: #6c757d;">
                            <i class="fas fa-print" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Print Orders</h3>
                            <p>You haven't placed any print orders yet.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.myOrders.map(order => `
                    <div class="order-card">
                        <div class="order-header">
                            <h3 class="order-title">Order #${order.transactionId}</h3>
                            <span class="order-status status-${order.status}">${order.status.toUpperCase()}</span>
                        </div>
                        <div class="order-details">
                            <div class="order-detail-item">
                                <span class="detail-label">File Name:</span>
                                <span class="detail-value">${order.fileName}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="detail-label">Print Type:</span>
                                <span class="detail-value">${this.getPrintTypeName(order.type)}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="detail-label">Copies:</span>
                                <span class="detail-value">${order.copies}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="detail-label">Amount:</span>
                                <span class="detail-value">‚Çπ${order.amount}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="detail-label">Order Date:</span>
                                <span class="detail-value">${Utils.formatDate(order.createdAt)}</span>
                            </div>
                            ${order.manualTransactionId ? `
                                <div class="order-detail-item">
                                    <span class="detail-label">Payment Transaction ID:</span>
                                    <span class="detail-value">${order.manualTransactionId}</span>
                                </div>
                            ` : ''}
                            ${order.printedAt ? `
                                <div class="order-detail-item">
                                    <span class="detail-label">Printed At:</span>
                                    <span class="detail-value">${Utils.formatDate(order.printedAt)}</span>
                                </div>
                            ` : ''}
                            ${order.completedAt ? `
                                <div class="order-detail-item">
                                    <span class="detail-label">Completed At:</span>
                                    <span class="detail-value">${Utils.formatDate(order.completedAt)}</span>
                                </div>
                            ` : ''}
                        </div>
                        ${order.status === 'pending' ? `
                            <div class="receipt-upload">
                                <p><i class="fas fa-info-circle"></i> Please upload your payment receipt to confirm your order</p>
                                <div class="file-upload-area">
                                    <input type="file" id="receipt-${order.id}" accept="image/*,.pdf" style="margin-bottom: 1rem;">
                                    <small style="color: #6c757d; display: block;">
                                        <i class="fas fa-camera"></i> Take a screenshot of your payment confirmation
                                    </small>
                                </div>
                                <button class="btn btn-primary" onclick="studentDashboard.uploadReceipt('${order.id}')">
                                    <i class="fas fa-upload"></i> Upload Receipt
                                </button>
                            </div>
                        ` : ''}
                        ${order.receiptURL ? `
                            <div class="order-actions">
                                <a href="${order.receiptURL}" target="_blank" class="btn btn-outline">
                                    <i class="fas fa-receipt"></i> View Receipt
                                </a>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            }

            getPrintTypeName(type) {
                const types = {
                    'single_bw': 'Single Side B/W',
                    'both_bw': 'Both Side B/W',
                    'single_color': 'Single Side Color',
                    'both_color': 'Both Side Color'
                };
                return types[type] || type;
            }

            async uploadReceipt(orderId) {
                const fileInput = document.getElementById(`receipt-${orderId}`);
                if (!fileInput || !fileInput.files[0]) {
                    Utils.showNotification('Please select a receipt file', 'error');
                    return;
                }

                try {
                    Utils.showNotification('Uploading receipt...', 'info');
                    const receiptURL = await dbManager.uploadReceipt(orderId, fileInput.files[0]);
                    await dbManager.updatePrintOrder(orderId, {
                        receiptURL: receiptURL,
                        status: 'paid'
                    });
                    Utils.showNotification('‚úÖ Receipt uploaded successfully! Order status updated to Paid.', 'success');
                    await this.loadMyOrders();
                } catch (error) {
                    Utils.showNotification('Error uploading receipt: ' + error.message, 'error');
                }
            }

            setupEventListeners() {
                // Material search
                const materialSearch = document.getElementById('materialSearch');
                if (materialSearch) {
                    materialSearch.addEventListener('input', (e) => {
                        this.filterMaterials();
                    });
                }

                // Material semester filter
                const semesterFilter = document.getElementById('semesterFilter');
                if (semesterFilter) {
                    semesterFilter.addEventListener('change', (e) => {
                        this.loadMaterials(e.target.value);
                    });
                }

                // Classroom search
                const classroomSearch = document.getElementById('classroomSearch');
                if (classroomSearch) {
                    classroomSearch.addEventListener('input', (e) => {
                        this.filterClassrooms();
                    });
                }

                // Classroom building filter
                const buildingFilter = document.getElementById('buildingFilter');
                if (buildingFilter) {
                    buildingFilter.addEventListener('change', (e) => {
                        this.filterClassrooms();
                    });
                }

                // Faculty search
                const facultySearch = document.getElementById('facultySearch');
                if (facultySearch) {
                    facultySearch.addEventListener('input', (e) => {
                        this.filterFacultyOffices();
                    });
                }

                // Faculty department filter
                const facultyDeptFilter = document.getElementById('facultyDeptFilter');
                if (facultyDeptFilter) {
                    facultyDeptFilter.addEventListener('change', (e) => {
                        this.filterFacultyOffices();
                    });
                }

                // Print service file input
                const fileInput = document.getElementById('fileInput');
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => {
                        this.handleFileSelect(e);
                    });
                }

                // Order date filter
                const orderDateFilter = document.getElementById('orderDateFilter');
                if (orderDateFilter) {
                    orderDateFilter.addEventListener('change', (e) => {
                        this.filterOrders();
                    });
                }
            }

            filterMaterials() {
                const searchTerm = document.getElementById('materialSearch').value.toLowerCase();
                
                this.filteredMaterials = this.allMaterials.filter(material => {
                    return material.title.toLowerCase().includes(searchTerm) ||
                           material.description.toLowerCase().includes(searchTerm);
                });

                this.renderMaterials();
            }

            filterClassrooms() {
                const searchTerm = document.getElementById('classroomSearch').value.toLowerCase();
                const buildingFilter = document.getElementById('buildingFilter').value;

                this.filteredClassrooms = this.allClassrooms.filter(classroom => {
                    const matchesSearch = 
                        classroom.roomNumber.toLowerCase().includes(searchTerm) ||
                        classroom.building.toLowerCase().includes(searchTerm) ||
                        classroom.floor.toLowerCase().includes(searchTerm) ||
                        classroom.locationDescription.toLowerCase().includes(searchTerm) ||
                        (classroom.equipment && classroom.equipment.toLowerCase().includes(searchTerm));

                    const matchesBuilding = !buildingFilter || classroom.building === buildingFilter;

                    return matchesSearch && matchesBuilding;
                });

                this.renderClassrooms();
            }

            filterFacultyOffices() {
                const searchTerm = document.getElementById('facultySearch').value.toLowerCase();
                const departmentFilter = document.getElementById('facultyDeptFilter').value;

                this.filteredFacultyOffices = this.allFacultyOffices.filter(office => {
                    const matchesSearch = 
                        office.facultyName.toLowerCase().includes(searchTerm) ||
                        office.department.toLowerCase().includes(searchTerm) ||
                        office.officeLocation.toLowerCase().includes(searchTerm) ||
                        office.officeHours.toLowerCase().includes(searchTerm) ||
                        (office.subjects && office.subjects.toLowerCase().includes(searchTerm)) ||
                        (office.contactInfo && office.contactInfo.toLowerCase().includes(searchTerm));

                    const matchesDepartment = !departmentFilter || office.department === departmentFilter;

                    return matchesSearch && matchesDepartment;
                });

                this.renderFacultyOffices();
            }

            filterOrders() {
                const dateFilter = document.getElementById('orderDateFilter').value;
                if (!dateFilter) {
                    this.renderMyOrders();
                    return;
                }

                const filteredOrders = this.myOrders.filter(order => {
                    const orderDate = new Date(order.createdAt).toDateString();
                    const filterDate = new Date(dateFilter).toDateString();
                    return orderDate === filterDate;
                });

                const container = document.getElementById('myOrdersList');
                if (!container) return;

                if (filteredOrders.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 3rem; color: #6c757d;">
                            <i class="fas fa-print" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Orders Found</h3>
                            <p>No print orders found for the selected date.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredOrders.map(order => `
                    <div class="order-card">
                        <div class="order-header">
                            <h3 class="order-title">Order #${order.transactionId}</h3>
                            <span class="order-status status-${order.status}">${order.status.toUpperCase()}</span>
                        </div>
                        <div class="order-details">
                            <div class="order-detail-item">
                                <span class="detail-label">File Name:</span>
                                <span class="detail-value">${order.fileName}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="detail-label">Print Type:</span>
                                <span class="detail-value">${this.getPrintTypeName(order.type)}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="detail-label">Copies:</span>
                                <span class="detail-value">${order.copies}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="detail-label">Amount:</span>
                                <span class="detail-value">‚Çπ${order.amount}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="detail-label">Order Date:</span>
                                <span class="detail-value">${Utils.formatDate(order.createdAt)}</span>
                            </div>
                            ${order.manualTransactionId ? `
                                <div class="order-detail-item">
                                    <span class="detail-label">Payment Transaction ID:</span>
                                    <span class="detail-value">${order.manualTransactionId}</span>
                                </div>
                            ` : ''}
                            ${order.printedAt ? `
                                <div class="order-detail-item">
                                    <span class="detail-label">Printed At:</span>
                                    <span class="detail-value">${Utils.formatDate(order.printedAt)}</span>
                                </div>
                            ` : ''}
                            ${order.completedAt ? `
                                <div class="order-detail-item">
                                    <span class="detail-label">Completed At:</span>
                                    <span class="detail-value">${Utils.formatDate(order.completedAt)}</span>
                                </div>
                            ` : ''}
                        </div>
                        ${order.status === 'pending' ? `
                            <div class="receipt-upload">
                                <p><i class="fas fa-info-circle"></i> Please upload your payment receipt to confirm your order</p>
                                <div class="file-upload-area">
                                    <input type="file" id="receipt-${order.id}" accept="image/*,.pdf" style="margin-bottom: 1rem;">
                                    <small style="color: #6c757d; display: block;">
                                        <i class="fas fa-camera"></i> Take a screenshot of your payment confirmation
                                    </small>
                                </div>
                                <button class="btn btn-primary" onclick="studentDashboard.uploadReceipt('${order.id}')">
                                    <i class="fas fa-upload"></i> Upload Receipt
                                </button>
                            </div>
                        ` : ''}
                        ${order.receiptURL ? `
                            <div class="order-actions">
                                <a href="${order.receiptURL}" target="_blank" class="btn btn-outline">
                                    <i class="fas fa-receipt"></i> View Receipt
                                </a>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            }

            renderClassrooms() {
                const container = document.getElementById('classroomsList');
                if (!container) return;
                
                if (this.filteredClassrooms.length === 0) {
                    container.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-door-closed" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Classrooms Found</h3>
                            <p>Try adjusting your search or filter criteria.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredClassrooms.map(classroom => `
                    <div class="location-card">
                        <div class="location-header">
                            <div style="flex: 1;">
                                <h3 class="location-title">Room ${classroom.roomNumber}</h3>
                                <span class="location-type">Classroom</span>
                            </div>
                        </div>
                        <div class="location-details">
                            <div class="detail-item">
                                <span class="detail-label">Building:</span>
                                <span class="detail-value">${classroom.building}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Floor:</span>
                                <span class="detail-value">${classroom.floor}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Capacity:</span>
                                <span class="detail-value">${classroom.capacity || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Equipment:</span>
                                <span class="detail-value">${classroom.equipment || 'Standard'}</span>
                            </div>
                        </div>
                        <p class="location-description">${classroom.locationDescription}</p>
                        <div class="location-meta">
                            <small style="color: #6c757d;">
                                <i class="fas fa-calendar"></i>
                                ${Utils.formatDate(classroom.createdAt)}
                            </small>
                            ${classroom.mapLink ? `
                                <a href="${classroom.mapLink}" target="_blank" class="btn btn-map">
                                    <i class="fas fa-map-marker-alt"></i>
                                    View on Map
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }

            renderFacultyOffices() {
                const container = document.getElementById('facultyOfficesList');
                if (!container) return;
                
                if (this.filteredFacultyOffices.length === 0) {
                    container.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-user-tie" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Faculty Offices Found</h3>
                            <p>Try adjusting your search or filter criteria.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredFacultyOffices.map(office => `
                    <div class="location-card">
                        <div class="location-header">
                            <div style="flex: 1;">
                                <h3 class="location-title">${office.facultyName}</h3>
                                <span class="location-type">Faculty Office</span>
                            </div>
                        </div>
                        <div class="location-details">
                            <div class="detail-item">
                                <span class="detail-label">Department:</span>
                                <span class="detail-value">${office.department}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Office Hours:</span>
                                <span class="detail-value">${office.officeHours}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Subjects:</span>
                                <span class="detail-value">${office.subjects || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Contact:</span>
                                <span class="detail-value">${office.contactInfo || 'N/A'}</span>
                            </div>
                        </div>
                        <p class="location-description">${office.officeLocation}</p>
                        <div class="location-meta">
                            <small style="color: #6c757d;">
                                <i class="fas fa-calendar"></i>
                                ${Utils.formatDate(office.createdAt)}
                            </small>
                            ${office.mapLink ? `
                                <a href="${office.mapLink}" target="_blank" class="btn btn-map">
                                    <i class="fas fa-map-marker-alt"></i>
                                    View on Map
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }

            getUniqueBuildings() {
                const buildings = [...new Set(this.allClassrooms.map(classroom => classroom.building))];
                return buildings;
            }

            updateBuildingFilter() {
                const buildingFilter = document.getElementById('buildingFilter');
                if (!buildingFilter) return;

                const buildings = this.getUniqueBuildings();
                buildingFilter.innerHTML = '<option value="">All Buildings</option>' +
                    buildings.map(building => `<option value="${building}">${building}</option>`).join('');
            }

            // Enhanced Print Service Methods
            async handleFileSelect(e) {
                this.selectedFile = e.target.files[0];
                if (this.selectedFile) {
                    if (this.selectedFile.type !== 'application/pdf') {
                        Utils.showNotification('Please select a PDF file', 'error');
                        this.selectedFile = null;
                        document.getElementById('fileInput').value = '';
                        return;
                    }

                    Utils.showNotification('üìÑ Counting PDF pages...', 'info');
                    
                    try {
                        this.pdfPageCount = await Utils.getPDFPageCount(this.selectedFile);
                        Utils.showNotification(`‚úÖ PDF loaded: ${this.pdfPageCount} pages detected`, 'success');
                        
                        // Update file info
                        this.fileInfo.fileName = this.selectedFile.name;
                        this.fileInfo.fileSize = (this.selectedFile.size / 1024 / 1024).toFixed(2) + ' MB';
                        this.fileInfo.pageCount = this.pdfPageCount;
                        
                        // Show file info and icons
                        this.showFileInfo();
                        this.showPrintIcons();
                        
                    } catch (error) {
                        Utils.showNotification('Error: ' + error.message, 'error');
                        this.selectedFile = null;
                        document.getElementById('fileInput').value = '';
                    }
                }
            }

            showFileInfo() {
                const fileInfoDiv = document.getElementById('fileInfo');
                if (!fileInfoDiv) return;

                fileInfoDiv.innerHTML = `
                    <div class="file-info">
                        <h4><i class="fas fa-file-pdf"></i> File Information</h4>
                        <p><strong>File Name:</strong> ${this.fileInfo.fileName}</p>
                        <p><strong>File Size:</strong> ${this.fileInfo.fileSize}</p>
                        <p><strong>Total Pages:</strong> ${this.fileInfo.pageCount}</p>
                        <p><strong>File Type:</strong> PDF Document</p>
                    </div>
                `;
                Utils.showElement('fileInfo');
            }

            showPrintIcons() {
                const iconsContainer = document.getElementById('printIcons');
                if (!iconsContainer) return;
                
                // Generate transaction ID if not already set
                if (!this.fileInfo.transactionId) {
                    this.fileInfo.transactionId = Utils.generateTransactionId();
                }
                
                // Get user's WhatsApp number if available
                if (!this.fileInfo.whatsappNumber && authSystem.userData) {
                    this.fileInfo.whatsappNumber = authSystem.userData.whatsappNumber || '';
                }
                
                iconsContainer.innerHTML = `
                    <div class="print-service-icons">
                        <div class="print-icon-item" onclick="studentDashboard.copyFileInfo()">
                            <i class="fas fa-copy"></i>
                            <div class="icon-text">
                                <div>Copy File Info</div>
                                <div class="icon-value">${this.fileInfo.fileName}</div>
                            </div>
                        </div>
                        
                        <div class="print-icon-item" onclick="studentDashboard.pasteGoogleDriveLink()">
                            <i class="fab fa-google-drive"></i>
                            <div class="icon-text">
                                <div>Google Drive Link</div>
                                <div class="icon-value">${this.fileInfo.googleDriveLink || 'Click to paste'}</div>
                            </div>
                        </div>
                        
                        <div class="print-icon-item" onclick="studentDashboard.pasteWhatsAppNumber()">
                            <i class="fab fa-whatsapp"></i>
                            <div class="icon-text">
                                <div>WhatsApp Number</div>
                                <div class="icon-value">${this.fileInfo.whatsappNumber || 'Click to paste'}</div>
                            </div>
                        </div>
                        
                        <div class="print-icon-item" onclick="studentDashboard.showTransactionId()">
                            <i class="fas fa-receipt"></i>
                            <div class="icon-text">
                                <div>Order ID</div>
                                <div class="icon-value">${this.fileInfo.transactionId}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input fields for icons -->
                    <div class="icon-input-container">
                        <div class="form-group">
                            <label class="form-label">Google Drive Link</label>
                            <div class="icon-input-group">
                                <input type="text" class="icon-input" id="driveLinkInput" 
                                       placeholder="Paste your Google Drive link here" 
                                       value="${this.fileInfo.googleDriveLink || ''}">
                                <button class="icon-input-btn" onclick="studentDashboard.updateDriveLink()">
                                    <i class="fas fa-save"></i> Save
                                </button>
                            </div>
                            <div class="validation-status ${this.fileInfo.googleDriveLink && Utils.validateGoogleDriveLink(this.fileInfo.googleDriveLink) ? 'valid' : 'invalid'}" id="driveLinkValidation">
                                <i class="fas ${this.fileInfo.googleDriveLink && Utils.validateGoogleDriveLink(this.fileInfo.googleDriveLink) ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                                ${this.fileInfo.googleDriveLink ? 
                                    (Utils.validateGoogleDriveLink(this.fileInfo.googleDriveLink) ? 'Valid Google Drive link' : 'Invalid Google Drive link') : 
                                    'Enter a Google Drive link'}
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">WhatsApp Number</label>
                            <div class="icon-input-group">
                                <input type="text" class="icon-input" id="whatsappInput" 
                                       placeholder="Enter your WhatsApp number" 
                                       value="${this.fileInfo.whatsappNumber || ''}">
                                <button class="icon-input-btn" onclick="studentDashboard.updateWhatsAppNumber()">
                                    <i class="fas fa-save"></i> Save
                                </button>
                            </div>
                            <div class="validation-status ${this.fileInfo.whatsappNumber && Utils.validateWhatsAppNumber(this.fileInfo.whatsappNumber) ? 'valid' : 'invalid'}" id="whatsappValidation">
                                <i class="fas ${this.fileInfo.whatsappNumber && Utils.validateWhatsAppNumber(this.fileInfo.whatsappNumber) ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                                ${this.fileInfo.whatsappNumber ? 
                                    (Utils.validateWhatsAppNumber(this.fileInfo.whatsappNumber) ? 'Valid WhatsApp number' : 'Invalid WhatsApp number') : 
                                    'Enter a WhatsApp number'}
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Order ID</label>
                            <div class="icon-input-group">
                                <input type="text" class="icon-input" id="transactionIdInput" 
                                       placeholder="Order ID will be auto-generated" 
                                       value="${this.fileInfo.transactionId || ''}" readonly>
                                <div class="validation-status valid">
                                    <i class="fas fa-info-circle"></i>
                                    Order ID is auto-generated for your order
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="enhanced-actions">
                        <button class="btn btn-outline" onclick="studentDashboard.cancelOrder()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                `;
                Utils.showElement('printIcons');
            }

            // NEW: Update Google Drive link from input
            updateDriveLink() {
                const driveLinkInput = document.getElementById('driveLinkInput');
                if (!driveLinkInput) return;
                
                const link = driveLinkInput.value.trim();
                if (link && Utils.validateGoogleDriveLink(link)) {
                    this.fileInfo.googleDriveLink = link;
                    this.showPrintIcons(); // Refresh to show updated value
                    Utils.showNotification('‚úÖ Google Drive link saved successfully!', 'success');
                } else {
                    Utils.showNotification('Please enter a valid Google Drive link', 'error');
                }
            }

            // NEW: Update WhatsApp number from input
            updateWhatsAppNumber() {
                const whatsappInput = document.getElementById('whatsappInput');
                if (!whatsappInput) return;
                
                const number = whatsappInput.value.trim();
                if (number && Utils.validateWhatsAppNumber(number)) {
                    this.fileInfo.whatsappNumber = number;
                    this.showPrintIcons(); // Refresh to show updated value
                    Utils.showNotification('‚úÖ WhatsApp number saved successfully!', 'success');
                } else {
                    Utils.showNotification('Please enter a valid WhatsApp number', 'error');
                }
            }

            // Icon action methods
            copyFileInfo() {
                const fileInfo = `File: ${this.fileInfo.fileName}\nSize: ${this.fileInfo.fileSize}\nPages: ${this.fileInfo.pageCount}`;
                Utils.copyToClipboard(fileInfo);
            }

            async pasteGoogleDriveLink() {
                try {
                    const text = await navigator.clipboard.readText();
                    if (text.includes('drive.google.com')) {
                        this.fileInfo.googleDriveLink = text;
                        this.showPrintIcons(); // Refresh icons to show updated value
                        Utils.showNotification('‚úÖ Google Drive link pasted successfully!', 'success');
                    } else {
                        Utils.showNotification('Please copy a valid Google Drive link first', 'error');
                    }
                } catch (error) {
                    Utils.showNotification('Failed to read clipboard. Please paste manually.', 'error');
                }
            }

            async pasteWhatsAppNumber() {
                try {
                    const text = await navigator.clipboard.readText();
                    if (Utils.validateWhatsAppNumber(text)) {
                        this.fileInfo.whatsappNumber = text;
                        this.showPrintIcons(); // Refresh icons to show updated value
                        Utils.showNotification('‚úÖ WhatsApp number pasted successfully!', 'success');
                    } else {
                        Utils.showNotification('Please copy a valid WhatsApp number first', 'error');
                    }
                } catch (error) {
                    Utils.showNotification('Failed to read clipboard. Please paste manually.', 'error');
                }
            }

            // NEW: Show transaction ID (removed copy functionality)
            showTransactionId() {
                Utils.showNotification(`Order ID: ${this.fileInfo.transactionId}`, 'info');
            }

            // NEW: Cancel order
            cancelOrder() {
                if (confirm("Are you sure you want to cancel this order? All entered information will be lost.")) {
                    this.resetPrintForm();
                    Utils.showNotification("Order cancelled", "info");
                }
            }

            calculateAmount() {
                if (!this.selectedFile) {
                    Utils.showNotification("Please select a PDF file first!", "error");
                    return;
                }

                // Validate required fields
                if (!this.fileInfo.googleDriveLink) {
                    Utils.showNotification("Please add Google Drive link", "error");
                    return;
                }

                if (!this.fileInfo.whatsappNumber) {
                    Utils.showNotification("Please add WhatsApp number", "error");
                    return;
                }

                const copies = parseInt(document.getElementById('printCopies').value) || 1;
                const type = document.getElementById('printType').value;

                // Price calculation based on print type
                let pricePerPage = 0;
                let printTypeName = '';

                switch(type) {
                    case 'single_bw':
                        pricePerPage = 1;
                        printTypeName = 'Black & White (Single Side)';
                        break;
                    case 'both_bw':
                        pricePerPage = 1.5;
                        printTypeName = 'Black & White (Both Sides)';
                        break;
                    case 'single_color':
                        pricePerPage = 6;
                        printTypeName = 'Color (Single Side)';
                        break;
                    case 'both_color':
                        pricePerPage = 10;
                        printTypeName = 'Color (Both Sides)';
                        break;
                }

                const totalPages = this.pdfPageCount * copies;
                const totalAmount = totalPages * pricePerPage;

                // Show price breakdown
                this.showPriceBreakdown(copies, printTypeName, pricePerPage, totalAmount);

                document.getElementById('amountText').innerText = `Total Amount: ‚Çπ${totalAmount}`;
                document.getElementById('paymentDiv').innerHTML =
                    `<button class="btn btn-success" onclick="studentDashboard.generatePaymentQR(${totalAmount})">
                        <i class="fas fa-qrcode"></i>
                        Generate Payment QR Code
                    </button>`;
            }

            showPriceBreakdown(copies, printType, pricePerPage, totalAmount) {
                const priceDiv = document.getElementById('priceBreakdown');
                if (!priceDiv) return;

                priceDiv.innerHTML = `
                    <div class="price-breakdown">
                        <h4><i class="fas fa-calculator"></i> Price Breakdown</h4>
                        <div class="price-item">
                            <span>Print Type:</span>
                            <span>${printType}</span>
                        </div>
                        <div class="price-item">
                            <span>Price per page:</span>
                            <span>‚Çπ${pricePerPage}</span>
                        </div>
                        <div class="price-item">
                            <span>Pages per copy:</span>
                            <span>${this.pdfPageCount} pages</span>
                        </div>
                        <div class="price-item">
                            <span>Number of copies:</span>
                            <span>${copies}</span>
                        </div>
                        <div class="price-item">
                            <span>Total pages to print:</span>
                            <span>${this.pdfPageCount * copies} pages</span>
                        </div>
                        <div class="price-total">
                            <span>Total Amount:</span>
                            <span>‚Çπ${totalAmount}</span>
                        </div>
                    </div>
                `;
                Utils.showElement('priceBreakdown');
            }

            generatePaymentQR(amount) {
                if (!this.selectedFile) {
                    Utils.showNotification("Please select a file first!", "error");
                    return;
                }

                // Validate all required information
                if (!this.fileInfo.googleDriveLink) {
                    Utils.showNotification("Please add Google Drive link", "error");
                    return;
                }

                if (!this.fileInfo.whatsappNumber) {
                    Utils.showNotification("Please add WhatsApp number", "error");
                    return;
                }

                const upiId = "8521228379@ibl"; // Your UPI ID
                const upiLink = `upi://pay?pa=${upiId}&pn=Campus%20Print%20Service&am=${amount}&tn=Print%20Order%20${this.fileInfo.transactionId}&cu=INR`;
                
                // Generate QR Code
                Utils.generateQRCode('qrCode', upiLink, 200);

                // Show payment instructions
                const paymentDiv = document.getElementById('paymentDiv');
                paymentDiv.innerHTML = `
                    <div class="payment-instructions">
                        <h4><i class="fas fa-mobile-alt"></i> Payment Instructions</h4>
                        <p>Scan the QR code with any UPI app to pay ‚Çπ${amount}</p>
                        <p><strong>Order ID:</strong> ${this.fileInfo.transactionId}</p>
                        <div class="action-buttons" style="justify-content: center; margin: 1rem 0;">
                            <button class="btn btn-primary" onclick="Utils.copyToClipboard('${this.fileInfo.transactionId}')">
                                <i class="fas fa-copy"></i> Copy Order ID
                            </button>
                        </div>
                        
                        <!-- NEW: Manual Transaction ID Input Section -->
                        <div class="manual-transaction-section">
                            <h4><i class="fas fa-receipt"></i> Payment Confirmation</h4>
                            <p>After successful payment, enter the transaction ID from your payment receipt:</p>
                            <div class="form-group">
                                <label class="form-label">Payment Transaction ID</label>
                                <input type="text" class="form-control" id="manualTransactionId" 
                                       placeholder="Enter transaction ID from your payment receipt" 
                                       value="${this.fileInfo.manualTransactionId || ''}">
                                <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
                                    <i class="fas fa-info-circle"></i>
                                    This is the transaction ID from your payment app/bank receipt
                                </small>
                            </div>
                        </div>
                        
                        <p>Click the button below to confirm your order after payment</p>
                        <button class="btn btn-success" onclick="studentDashboard.uploadAndPay(${amount})">
                            <i class="fas fa-check-circle"></i>
                            Confirm Payment & Submit Order
                        </button>
                    </div>
                `;

                Utils.showElement('qrContainer');
            }

            async uploadAndPay(amount) {
                const email = authSystem.userData.email;
                if (!this.selectedFile) {
                    Utils.showNotification("Please select a file!", "error");
                    return;
                }

                // Validate all required information
                if (!this.fileInfo.googleDriveLink) {
                    Utils.showNotification("Please add Google Drive link", "error");
                    return;
                }

                if (!this.fileInfo.whatsappNumber) {
                    Utils.showNotification("Please add WhatsApp number", "error");
                    return;
                }

                // Get manual transaction ID
                const manualTransactionIdInput = document.getElementById('manualTransactionId');
                if (!manualTransactionIdInput || !manualTransactionIdInput.value.trim()) {
                    Utils.showNotification("Please enter the payment transaction ID from your receipt", "error");
                    return;
                }

                const manualTransactionId = manualTransactionIdInput.value.trim();

                try {
                    Utils.showNotification("Processing order...", "info");
                    
                    // Note: We're NOT uploading the PDF file to Firebase
                    // Only storing the information and Google Drive link
                    
                    const printType = document.getElementById('printType').value;
                    const copies = parseInt(document.getElementById('printCopies').value) || 1;

                    const orderData = {
                        email: email,
                        fileName: this.fileInfo.fileName,
                        fileSize: this.fileInfo.fileSize,
                        pageCount: this.fileInfo.pageCount,
                        googleDriveLink: this.fileInfo.googleDriveLink,
                        whatsappNumber: this.fileInfo.whatsappNumber,
                        type: printType,
                        copies: copies,
                        amount: amount,
                        transactionId: this.fileInfo.transactionId,
                        manualTransactionId: manualTransactionId, // NEW: Store manual transaction ID
                        timestamp: new Date().toISOString(),
                        status: 'pending',
                        studentName: authSystem.userData.fullName,
                        userId: authSystem.currentUser.uid,
                        department: authSystem.userData.department
                    };

                    const orderId = await dbManager.addPrintOrder(orderData);

                    if (orderId) {
                        Utils.showNotification("üéâ Order submitted successfully! Please upload your payment receipt.", "success");
                        
                        // Show upload status (PDF not uploaded, only info)
                        this.showUploadStatus();
                        
                        // Reset form
                        this.resetPrintForm();
                        
                        // Reload orders
                        await this.loadMyOrders();
                    } else {
                        throw new Error('Failed to create order');
                    }

                } catch (error) {
                    console.error('‚ùå Error processing print order:', error);
                    Utils.showNotification('Error processing order: ' + error.message, 'error');
                }
            }

            showUploadStatus() {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'upload-status success';
                statusDiv.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    Order information submitted successfully! 
                    <br><small>PDF file is stored in your Google Drive (not uploaded to our system)</small>
                    <br><small><strong>Order ID:</strong> ${this.fileInfo.transactionId}</small>
                    <br><small><strong>Payment Transaction ID:</strong> ${this.fileInfo.manualTransactionId}</small>
                `;
                
                const printServiceBox = document.querySelector('.print-service-box');
                if (printServiceBox) {
                    printServiceBox.appendChild(statusDiv);
                    
                    // Auto remove after 5 seconds
                    setTimeout(() => {
                        statusDiv.remove();
                    }, 5000);
                }
            }

            resetPrintForm() {
                document.getElementById('printServiceForm').reset();
                document.getElementById('amountText').innerText = '';
                document.getElementById('paymentDiv').innerHTML = '';
                document.getElementById('qrContainer').innerHTML = '';
                document.getElementById('fileInfo').innerHTML = '';
                document.getElementById('priceBreakdown').innerHTML = '';
                document.getElementById('printIcons').innerHTML = '';
                
                Utils.hideElement('qrContainer');
                Utils.hideElement('fileInfo');
                Utils.hideElement('priceBreakdown');
                Utils.hideElement('printIcons');
                
                this.selectedFile = null;
                this.pdfPageCount = 0;
                this.fileInfo = {
                    fileName: '',
                    fileSize: '',
                    pageCount: 0,
                    googleDriveLink: '',
                    whatsappNumber: '',
                    transactionId: '',
                    manualTransactionId: ''
                };
            }
        }

        class FacultyDashboard {
            constructor() {
                this.department = '';
                this.allMaterials = [];
                this.filteredMaterials = [];
            }

            async init() {
                await this.getFacultyDepartment();
                await this.loadMaterials();
                this.setupEventListeners();
            }

            async getFacultyDepartment() {
                try {
                    const snapshot = await database.ref('users/' + authSystem.currentUser.uid).once('value');
                    this.department = snapshot.val().department || 'CSE';
                } catch (error) {
                    this.department = 'CSE';
                }
            }

            async loadMaterials() {
                this.allMaterials = await dbManager.getFacultyMaterials(this.department);
                this.filteredMaterials = [...this.allMaterials];
                this.renderMaterials();
            }

            renderMaterials() {
                const container = document.getElementById('facultyMaterials');
                if (!container) return;
                
                if (this.filteredMaterials.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 3rem; color: #6c757d;">
                            <i class="fas fa-folder-open" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Materials Uploaded</h3>
                            <p>You haven't uploaded any study materials yet.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredMaterials.map(material => `
                    <div class="material-card">
                        <div class="material-header">
                            <div style="flex: 1;">
                                <h3 class="material-title">${material.title}</h3>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <span class="drive-badge">
                                        <i class="fab fa-google-drive"></i>
                                        Google Drive
                                    </span>
                                    ${material.semester ? `
                                        <span class="material-semester">
                                            <i class="fas fa-graduation-cap"></i>
                                            Semester ${material.semester}
                                        </span>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                        <p class="material-description">${material.description}</p>
                        <div class="material-meta">
                            <div>
                                <small style="color: #6c757d;">
                                    <i class="fas fa-calendar"></i>
                                    ${Utils.formatDate(material.createdAt)}
                                </small>
                                ${material.downloadCount ? `
                                    <small style="color: #28a745; margin-left: 1rem;">
                                        <i class="fas fa-download"></i>
                                        ${material.downloadCount} downloads
                                    </small>
                                ` : ''}
                            </div>
                            <div class="action-buttons">
                                <button class="btn-small btn-edit" onclick="facultyDashboard.editMaterial('${material.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-small btn-delete" onclick="facultyDashboard.deleteMaterial('${material.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            setupEventListeners() {
                const form = document.getElementById('materialUploadForm');
                if (form) {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.uploadMaterial();
                    });
                }

                // Material search
                const materialSearch = document.getElementById('facultyMaterialSearch');
                if (materialSearch) {
                    materialSearch.addEventListener('input', (e) => {
                        this.filterMaterials();
                    });
                }
            }

            filterMaterials() {
                const searchTerm = document.getElementById('facultyMaterialSearch').value.toLowerCase();
                
                this.filteredMaterials = this.allMaterials.filter(material => {
                    return material.title.toLowerCase().includes(searchTerm) ||
                           material.description.toLowerCase().includes(searchTerm);
                });

                this.renderMaterials();
            }

            async uploadMaterial() {
                const title = document.getElementById('materialTitle').value;
                const description = document.getElementById('materialDescription').value;
                const driveLink = document.getElementById('driveLink').value;
                const materialType = document.getElementById('materialType').value;
                const semester = document.getElementById('materialSemester').value;

                if (!title || !description || !driveLink || !semester) {
                    Utils.showNotification('Please fill all required fields', 'error');
                    return;
                }

                if (!this.isValidDriveLink(driveLink)) {
                    Utils.showNotification('Please provide a valid Google Drive shareable link', 'error');
                    return;
                }

                try {
                    const directDownloadLink = this.convertToDirectDownload(driveLink);
                    
                    const materialData = {
                        title: title,
                        description: description,
                        type: materialType,
                        department: this.department,
                        semester: semester,
                        fileName: title.replace(/[^a-zA-Z0-9]/g, '_') + '.pdf',
                        fileURL: directDownloadLink,
                        fileSize: 'Google Drive',
                        source: 'google_drive'
                    };

                    await dbManager.addMaterial(materialData);
                    document.getElementById('materialUploadForm').reset();
                    Utils.showNotification('‚úÖ Material published successfully!', 'success');
                    await this.loadMaterials();
                    
                } catch (error) {
                    Utils.showNotification('Error: ' + error.message, 'error');
                }
            }

            async editMaterial(materialId) {
                const material = this.allMaterials.find(m => m.id === materialId);
                if (!material) return;

                // Create a modal for editing
                const newTitle = prompt("Enter new title:", material.title);
                if (!newTitle) return;

                const newDescription = prompt("Enter new description:", material.description);
                if (!newDescription) return;

                const newSemester = prompt("Enter new semester:", material.semester);
                if (!newSemester) return;

                try {
                    await dbManager.updateMaterial(materialId, {
                        title: newTitle,
                        description: newDescription,
                        semester: newSemester
                    });

                    Utils.showNotification('‚úÖ Material updated successfully!', 'success');
                    await this.loadMaterials();
                } catch (error) {
                    Utils.showNotification('Error updating material: ' + error.message, 'error');
                }
            }

            async deleteMaterial(materialId) {
                if (!confirm("Are you sure you want to delete this material?")) return;

                try {
                    await dbManager.deleteMaterial(materialId);
                    Utils.showNotification('üóëÔ∏è Material deleted successfully!', 'success');
                    await this.loadMaterials();
                } catch (error) {
                    Utils.showNotification('Error deleting material: ' + error.message, 'error');
                }
            }

            isValidDriveLink(url) {
                return /https:\/\/drive\.google\.com\/(file\/d\/|open\?id=)([a-zA-Z0-9_-]+)/.test(url);
            }

            convertToDirectDownload(shareableLink) {
                let fileId = '';
                const match1 = shareableLink.match(/\/file\/d\/([^\/]+)/);
                if (match1) fileId = match1[1];
                
                const match2 = shareableLink.match(/[\?&]id=([^&]+)/);
                if (match2) fileId = match2[1];
                
                if (!fileId) throw new Error('Invalid Google Drive link');
                return `https://drive.google.com/uc?export=download&id=${fileId}`;
            }
        }

        class AdminDashboard {
            constructor() {
                this.allClassrooms = [];
                this.filteredClassrooms = [];
                this.allFacultyOffices = [];
                this.filteredFacultyOffices = [];
            }

            async init() {
                this.setupEventListeners();
                await this.loadClassrooms();
                await this.loadFacultyOffices();
            }

            setupEventListeners() {
                const classroomForm = document.getElementById('classroomForm');
                if (classroomForm) {
                    classroomForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.addClassroom();
                    });
                }

                const officeForm = document.getElementById('facultyOfficeForm');
                if (officeForm) {
                    officeForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.addFacultyOffice();
                    });
                }

                // Classroom search
                const classroomSearch = document.getElementById('adminClassroomSearch');
                if (classroomSearch) {
                    classroomSearch.addEventListener('input', (e) => {
                        this.filterClassrooms();
                    });
                }

                // Faculty office search
                const facultySearch = document.getElementById('adminFacultySearch');
                if (facultySearch) {
                    facultySearch.addEventListener('input', (e) => {
                        this.filterFacultyOffices();
                    });
                }
            }

            async addClassroom() {
                const roomNumber = document.getElementById('roomNumber').value;
                const building = document.getElementById('building').value;
                const floor = document.getElementById('floor').value;
                const locationDescription = document.getElementById('locationDescription').value;
                const capacity = document.getElementById('capacity').value;
                const equipment = document.getElementById('equipment').value;
                const mapLink = document.getElementById('mapLink').value;

                if (!roomNumber || !building || !floor || !locationDescription) {
                    Utils.showNotification('Please fill all required fields', 'error');
                    return;
                }

                const classroomData = {
                    roomNumber: roomNumber,
                    building: building,
                    floor: floor,
                    locationDescription: locationDescription,
                    capacity: capacity,
                    equipment: equipment,
                    mapLink: mapLink
                };

                await dbManager.addClassroom(classroomData);
                document.getElementById('classroomForm').reset();
                await this.loadClassrooms();
            }

            async loadClassrooms() {
                this.allClassrooms = await dbManager.getClassrooms();
                this.filteredClassrooms = [...this.allClassrooms];
                this.renderClassrooms();
            }

            renderClassrooms() {
                const container = document.getElementById('classroomsList');
                if (!container) return;
                
                if (this.filteredClassrooms.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 3rem; color: #6c757d;">
                            <i class="fas fa-door-closed" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Classrooms Added</h3>
                            <p>Add classroom details to help students locate them easily.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredClassrooms.map(classroom => `
                    <div class="location-card">
                        <div class="location-header">
                            <div style="flex: 1;">
                                <h3 class="location-title">Room ${classroom.roomNumber}</h3>
                                <span class="location-type">Classroom</span>
                            </div>
                            <div class="action-buttons">
                                <button class="btn-small btn-edit" onclick="adminDashboard.editClassroom('${classroom.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-small btn-delete" onclick="adminDashboard.deleteClassroom('${classroom.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                        <div class="location-details">
                            <div class="detail-item">
                                <span class="detail-label">Building:</span>
                                <span class="detail-value">${classroom.building}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Floor:</span>
                                <span class="detail-value">${classroom.floor}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Capacity:</span>
                                <span class="detail-value">${classroom.capacity || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Equipment:</span>
                                <span class="detail-value">${classroom.equipment || 'Standard'}</span>
                            </div>
                        </div>
                        <p class="location-description">${classroom.locationDescription}</p>
                        <div class="location-meta">
                            <small style="color: #6c757d;">
                                <i class="fas fa-calendar"></i>
                                ${Utils.formatDate(classroom.createdAt)}
                            </small>
                            ${classroom.mapLink ? `
                                <a href="${classroom.mapLink}" target="_blank" class="btn btn-map">
                                    <i class="fas fa-map-marker-alt"></i>
                                    View on Map
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }

            filterClassrooms() {
                const searchTerm = document.getElementById('adminClassroomSearch').value.toLowerCase();
                
                this.filteredClassrooms = this.allClassrooms.filter(classroom => {
                    return classroom.roomNumber.toLowerCase().includes(searchTerm) ||
                           classroom.building.toLowerCase().includes(searchTerm) ||
                           classroom.floor.toLowerCase().includes(searchTerm) ||
                           classroom.locationDescription.toLowerCase().includes(searchTerm);
                });

                this.renderClassrooms();
            }

            async editClassroom(classroomId) {
                const classroom = this.allClassrooms.find(c => c.id === classroomId);
                if (!classroom) return;

                // Create a modal for editing
                const newRoomNumber = prompt("Enter new room number:", classroom.roomNumber);
                if (!newRoomNumber) return;

                const newBuilding = prompt("Enter new building:", classroom.building);
                if (!newBuilding) return;

                const newFloor = prompt("Enter new floor:", classroom.floor);
                if (!newFloor) return;

                const newLocation = prompt("Enter new location description:", classroom.locationDescription);
                if (!newLocation) return;

                const newCapacity = prompt("Enter new capacity:", classroom.capacity || '');
                const newEquipment = prompt("Enter new equipment:", classroom.equipment || '');
                const newMapLink = prompt("Enter new map link:", classroom.mapLink || '');

                try {
                    await dbManager.updateClassroom(classroomId, {
                        roomNumber: newRoomNumber,
                        building: newBuilding,
                        floor: newFloor,
                        locationDescription: newLocation,
                        capacity: newCapacity,
                        equipment: newEquipment,
                        mapLink: newMapLink
                    });

                    Utils.showNotification('‚úÖ Classroom updated successfully!', 'success');
                    await this.loadClassrooms();
                } catch (error) {
                    Utils.showNotification('Error updating classroom: ' + error.message, 'error');
                }
            }

            async deleteClassroom(classroomId) {
                if (!confirm("Are you sure you want to delete this classroom?")) return;

                try {
                    await dbManager.deleteClassroom(classroomId);
                    Utils.showNotification('üóëÔ∏è Classroom deleted successfully!', 'success');
                    await this.loadClassrooms();
                } catch (error) {
                    Utils.showNotification('Error deleting classroom: ' + error.message, 'error');
                }
            }

            async addFacultyOffice() {
                const facultyName = document.getElementById('facultyName').value;
                const department = document.getElementById('officeDepartment').value;
                const officeLocation = document.getElementById('officeLocation').value;
                const officeHours = document.getElementById('officeHours').value;
                const subjects = document.getElementById('subjects').value;
                const contactInfo = document.getElementById('contactInfo').value;
                const mapLink = document.getElementById('officeMapLink').value;

                if (!facultyName || !department || !officeLocation || !officeHours) {
                    Utils.showNotification('Please fill all required fields', 'error');
                    return;
                }

                const officeData = {
                    facultyName: facultyName,
                    department: department,
                    officeLocation: officeLocation,
                    officeHours: officeHours,
                    subjects: subjects,
                    contactInfo: contactInfo,
                    mapLink: mapLink
                };

                await dbManager.addFacultyOffice(officeData);
                document.getElementById('facultyOfficeForm').reset();
                await this.loadFacultyOffices();
            }

            async loadFacultyOffices() {
                const offices = await dbManager.getFacultyOffices();
                this.allFacultyOffices = offices;
                this.filteredFacultyOffices = [...offices];
                this.renderFacultyOffices();
            }

            filterFacultyOffices() {
                const searchTerm = document.getElementById('adminFacultySearch').value.toLowerCase();
                
                this.filteredFacultyOffices = this.allFacultyOffices.filter(office => {
                    return office.facultyName.toLowerCase().includes(searchTerm) ||
                           office.department.toLowerCase().includes(searchTerm) ||
                           office.officeLocation.toLowerCase().includes(searchTerm);
                });

                this.renderFacultyOffices();
            }

            renderFacultyOffices() {
                const container = document.getElementById('facultyOfficesList');
                if (!container) return;
                
                if (this.filteredFacultyOffices.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 3rem; color: #6c757d;">
                            <i class="fas fa-user-tie" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Faculty Offices Added</h3>
                            <p>Add faculty office details to help students find their professors.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredFacultyOffices.map(office => `
                    <div class="location-card">
                        <div class="location-header">
                            <div style="flex: 1;">
                                <h3 class="location-title">${office.facultyName}</h3>
                                <span class="location-type">Faculty Office</span>
                            </div>
                            <div class="action-buttons">
                                <button class="btn-small btn-edit" onclick="adminDashboard.editFacultyOffice('${office.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-small btn-delete" onclick="adminDashboard.deleteFacultyOffice('${office.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                        <div class="location-details">
                            <div class="detail-item">
                                <span class="detail-label">Department:</span>
                                <span class="detail-value">${office.department}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Office Hours:</span>
                                <span class="detail-value">${office.officeHours}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Subjects:</span>
                                <span class="detail-value">${office.subjects || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Contact:</span>
                                <span class="detail-value">${office.contactInfo || 'N/A'}</span>
                            </div>
                        </div>
                        <p class="location-description">${office.officeLocation}</p>
                        <div class="location-meta">
                            <small style="color: #6c757d;">
                                <i class="fas fa-calendar"></i>
                                ${Utils.formatDate(office.createdAt)}
                            </small>
                            ${office.mapLink ? `
                                <a href="${office.mapLink}" target="_blank" class="btn btn-map">
                                    <i class="fas fa-map-marker-alt"></i>
                                    View on Map
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }

            async editFacultyOffice(officeId) {
                const office = this.allFacultyOffices.find(o => o.id === officeId);
                if (!office) return;

                // Create a modal for editing
                const newName = prompt("Enter new faculty name:", office.facultyName);
                if (!newName) return;

                const newDepartment = prompt("Enter new department:", office.department);
                if (!newDepartment) return;

                const newLocation = prompt("Enter new office location:", office.officeLocation);
                if (!newLocation) return;

                const newHours = prompt("Enter new office hours:", office.officeHours);
                if (!newHours) return;

                const newSubjects = prompt("Enter new subjects:", office.subjects || '');
                const newContact = prompt("Enter new contact info:", office.contactInfo || '');
                const newMapLink = prompt("Enter new map link:", office.mapLink || '');

                try {
                    await dbManager.updateFacultyOffice(officeId, {
                        facultyName: newName,
                        department: newDepartment,
                        officeLocation: newLocation,
                        officeHours: newHours,
                        subjects: newSubjects,
                        contactInfo: newContact,
                        mapLink: newMapLink
                    });

                    Utils.showNotification('‚úÖ Faculty office updated successfully!', 'success');
                    await this.loadFacultyOffices();
                } catch (error) {
                    Utils.showNotification('Error updating faculty office: ' + error.message, 'error');
                }
            }

            async deleteFacultyOffice(officeId) {
                if (!confirm("Are you sure you want to delete this faculty office?")) return;

                try {
                    await dbManager.deleteFacultyOffice(officeId);
                    Utils.showNotification('üóëÔ∏è Faculty office deleted successfully!', 'success');
                    await this.loadFacultyOffices();
                } catch (error) {
                    Utils.showNotification('Error deleting faculty office: ' + error.message, 'error');
                }
            }
        }

        // =============================================
        // ENHANCED XEROX ADMIN DASHBOARD
        // =============================================
        class XeroxAdminDashboard {
            constructor() {
                this.allOrders = [];
                this.filteredOrders = [];
                this.stats = {
                    totalOrders: 0,
                    pendingOrders: 0,
                    completedOrders: 0,
                    revenue24h: 0
                };
            }

            async init() {
                await this.loadOrders();
                this.setupEventListeners();
                this.updateStats();
            }

            async loadOrders() {
                try {
                    console.log("üîÑ Loading orders for Xerox Admin...");
                    this.allOrders = await dbManager.getPrintOrders();
                    this.filteredOrders = [...this.allOrders];
                    console.log(`‚úÖ Loaded ${this.allOrders.length} orders`);
                    this.renderOrders();
                    this.updateStats();
                } catch (error) {
                    console.error("‚ùå Error loading orders:", error);
                }
            }

            updateStats() {
                // Calculate 24-hour statistics
                const stats24h = Utils.calculate24HourStats(this.allOrders);
                
                this.stats = {
                    totalOrders: this.allOrders.length,
                    pendingOrders: this.allOrders.filter(order => order.status === 'pending').length,
                    completedOrders: this.allOrders.filter(order => order.status === 'completed').length,
                    revenue24h: stats24h.revenue,
                    orders24h: stats24h.orderCount,
                    completed24h: stats24h.completedCount
                };
                
                this.renderStats();
            }

            renderStats() {
                const statsContainer = document.getElementById('xeroxAdminStats');
                if (!statsContainer) return;
                
                statsContainer.innerHTML = `
                    <div class="xerox-admin-stats">
                        <div class="xerox-stat-card">
                            <div class="xerox-stat-number">${this.stats.totalOrders}</div>
                            <div class="xerox-stat-label">Total Orders</div>
                        </div>
                        <div class="xerox-stat-card">
                            <div class="xerox-stat-number">${this.stats.pendingOrders}</div>
                            <div class="xerox-stat-label">Pending Orders</div>
                        </div>
                        <div class="xerox-stat-card">
                            <div class="xerox-stat-number">${this.stats.completedOrders}</div>
                            <div class="xerox-stat-label">Completed Orders</div>
                        </div>
                        <div class="xerox-stat-card">
                            <div class="xerox-stat-number">‚Çπ${this.stats.revenue24h}</div>
                            <div class="xerox-stat-label">24h Revenue</div>
                        </div>
                        <div class="xerox-stat-card">
                            <div class="xerox-stat-number">${this.stats.orders24h}</div>
                            <div class="xerox-stat-label">24h Orders</div>
                        </div>
                        <div class="xerox-stat-card">
                            <div class="xerox-stat-number">${this.stats.completed24h}</div>
                            <div class="xerox-stat-label">24h Completed</div>
                        </div>
                    </div>
                `;
            }

            renderOrders() {
                const container = document.getElementById('xeroxOrdersList');
                if (!container) return;
                
                if (this.filteredOrders.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 3rem; color: #6c757d;">
                            <i class="fas fa-print" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Print Orders</h3>
                            <p>No print orders have been placed yet.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredOrders.map(order => `
                    <div class="order-card">
                        <div class="order-header">
                            <div>
                                <h3 class="order-title">Order #${order.transactionId}</h3>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <select class="order-status-select ${order.status}" onchange="xeroxAdminDashboard.updateOrderStatus('${order.id}', this.value)" id="status-${order.id}">
                                        <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="paid" ${order.status === 'paid' ? 'selected' : ''}>Paid</option>
                                        <option value="printed" ${order.status === 'printed' ? 'selected' : ''}>Printed</option>
                                        <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Completed</option>
                                        <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                    </select>
                                    ${order.department ? `
                                        <span class="department-badge">
                                            <i class="fas fa-graduation-cap"></i>
                                            ${order.department}
                                        </span>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn-small btn-danger" onclick="xeroxAdminDashboard.deleteOrder('${order.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                        
                        <!-- Enhanced Order Information Section -->
                        <div class="print-info-section">
                            <h4><i class="fas fa-info-circle"></i> Order Information</h4>
                            <div class="print-info-grid">
                                <div class="print-info-item">
                                    <span class="print-info-label">Student Name:</span>
                                    <span class="print-info-value">${order.studentName || 'N/A'}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">Email:</span>
                                    <span class="print-info-value">${order.email}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">WhatsApp:</span>
                                    <span class="print-info-value">${order.whatsappNumber || 'N/A'}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">Department:</span>
                                    <span class="print-info-value">${order.department || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- File Information Section -->
                        <div class="print-info-section">
                            <h4><i class="fas fa-file-pdf"></i> File Information</h4>
                            <div class="print-info-grid">
                                <div class="print-info-item">
                                    <span class="print-info-label">File Name:</span>
                                    <span class="print-info-value">${order.fileName}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">File Size:</span>
                                    <span class="print-info-value">${order.fileSize || 'N/A'}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">Total Pages:</span>
                                    <span class="print-info-value">${order.pageCount}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">Google Drive Link:</span>
                                    <span class="print-info-value">
                                        ${order.googleDriveLink ? 
                                            `<a href="${order.googleDriveLink}" target="_blank" style="color: var(--primary);">
                                                <i class="fab fa-google-drive"></i> Open PDF
                                            </a>` : 
                                            'N/A'
                                        }
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Print Details Section -->
                        <div class="print-info-section">
                            <h4><i class="fas fa-print"></i> Print Details</h4>
                            <div class="print-info-grid">
                                <div class="print-info-item">
                                    <span class="print-info-label">Print Type:</span>
                                    <span class="print-info-value">${this.getPrintTypeName(order.type)}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">Copies:</span>
                                    <span class="print-info-value">${order.copies}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">Amount:</span>
                                    <span class="print-info-value">‚Çπ${order.amount}</span>
                                </div>
                                <div class="print-info-item">
                                    <span class="print-info-label">Order Date:</span>
                                    <span class="print-info-value">${Utils.formatDate(order.createdAt)}</span>
                                </div>
                                ${order.manualTransactionId ? `
                                    <div class="print-info-item">
                                        <span class="print-info-label">Payment Transaction ID:</span>
                                        <span class="print-info-value">${order.manualTransactionId}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        ${order.printedAt ? `
                            <div class="print-info-item">
                                <span class="print-info-label">Printed At:</span>
                                <span class="print-info-value">${Utils.formatDate(order.printedAt)}</span>
                            </div>
                        ` : ''}
                        ${order.completedAt ? `
                            <div class="print-info-item">
                                <span class="print-info-label">Completed At:</span>
                                <span class="print-info-value">${Utils.formatDate(order.completedAt)}</span>
                            </div>
                        ` : ''}
                        
                        <div class="order-actions">
                            ${order.googleDriveLink ? `
                                <a href="${order.googleDriveLink}" target="_blank" class="btn btn-outline">
                                    <i class="fab fa-google-drive"></i> View PDF
                                </a>
                            ` : ''}
                            ${order.receiptURL ? `
                                <a href="${order.receiptURL}" target="_blank" class="btn btn-outline">
                                    <i class="fas fa-receipt"></i> View Receipt
                                </a>
                            ` : ''}
                            <button class="btn btn-primary" onclick="Utils.copyToClipboard('${order.transactionId}')">
                                <i class="fas fa-copy"></i> Copy Order ID
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            getPrintTypeName(type) {
                const types = {
                    'single_bw': 'Single Side B/W',
                    'both_bw': 'Both Side B/W',
                    'single_color': 'Single Side Color',
                    'both_color': 'Both Side Color'
                };
                return types[type] || type;
            }

            async updateOrderStatus(orderId, status) {
                try {
                    console.log(`üîÑ Updating order ${orderId} to status: ${status}`);
                    
                    const updateData = { status: status };
                    
                    if (status === 'printed') {
                        updateData.printedAt = new Date().toISOString();
                    } else if (status === 'completed') {
                        updateData.completedAt = new Date().toISOString();
                    }

                    const success = await dbManager.updatePrintOrder(orderId, updateData);
                    
                    if (success) {
                        Utils.showNotification(`‚úÖ Order status updated to ${status}`, 'success');
                        await this.loadOrders();
                    } else {
                        throw new Error('Failed to update order');
                    }
                } catch (error) {
                    console.error('‚ùå Error updating order status:', error);
                    Utils.showNotification('Error updating order status: ' + error.message, 'error');
                }
            }

            // NEW: Delete order
            async deleteOrder(orderId) {
                if (!confirm("Are you sure you want to delete this order? This action cannot be undone.")) {
                    return;
                }

                try {
                    const success = await dbManager.deletePrintOrder(orderId);
                    if (success) {
                        Utils.showNotification('üóëÔ∏è Order deleted successfully!', 'success');
                        await this.loadOrders();
                    } else {
                        throw new Error('Failed to delete order');
                    }
                } catch (error) {
                    console.error('‚ùå Error deleting order:', error);
                    Utils.showNotification('Error deleting order: ' + error.message, 'error');
                }
            }

            setupEventListeners() {
                // Order search
                const orderSearch = document.getElementById('xeroxOrderSearch');
                if (orderSearch) {
                    orderSearch.addEventListener('input', (e) => {
                        this.filterOrders();
                    });
                }

                // Order status filter
                const statusFilter = document.getElementById('xeroxOrderStatusFilter');
                if (statusFilter) {
                    statusFilter.addEventListener('change', (e) => {
                        this.filterOrders();
                    });
                }

                // Order date filter
                const orderDateFilter = document.getElementById('xeroxOrderDateFilter');
                if (orderDateFilter) {
                    orderDateFilter.addEventListener('change', (e) => {
                        this.filterOrders();
                    });
                }

                // Department filter
                const departmentFilter = document.getElementById('xeroxDepartmentFilter');
                if (departmentFilter) {
                    departmentFilter.addEventListener('change', (e) => {
                        this.filterOrders();
                    });
                }
            }

            filterOrders() {
                const searchTerm = document.getElementById('xeroxOrderSearch').value.toLowerCase();
                const statusFilter = document.getElementById('xeroxOrderStatusFilter').value;
                const dateFilter = document.getElementById('xeroxOrderDateFilter').value;
                const departmentFilter = document.getElementById('xeroxDepartmentFilter').value;

                this.filteredOrders = this.allOrders.filter(order => {
                    const matchesSearch = 
                        order.transactionId.toLowerCase().includes(searchTerm) ||
                        order.email.toLowerCase().includes(searchTerm) ||
                        (order.studentName && order.studentName.toLowerCase().includes(searchTerm)) ||
                        order.fileName.toLowerCase().includes(searchTerm) ||
                        (order.department && order.department.toLowerCase().includes(searchTerm)) ||
                        (order.manualTransactionId && order.manualTransactionId.toLowerCase().includes(searchTerm));

                    const matchesStatus = !statusFilter || order.status === statusFilter;

                    let matchesDate = true;
                    if (dateFilter) {
                        const orderDate = new Date(order.createdAt).toDateString();
                        const filterDate = new Date(dateFilter).toDateString();
                        matchesDate = orderDate === filterDate;
                    }

                    const matchesDepartment = !departmentFilter || order.department === departmentFilter;

                    return matchesSearch && matchesStatus && matchesDate && matchesDepartment;
                });

                this.renderOrders();
            }
        }

        // =============================================
        // MAIN APPLICATION
        // =============================================
        class App {
            static currentRole = null;
            static currentView = 'dashboard';

            static showAuthPage() {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div class="auth-container">
                        <div class="auth-card">
                            <div class="auth-header">
                                <h1 class="auth-title">Campus Portal</h1>
                                <p class="auth-subtitle">Professional Learning Management System</p>
                            </div>
                            
                            <div class="tabs">
                                <div class="tab active" onclick="App.switchTab('login')">Login</div>
                                <div class="tab" onclick="App.switchTab('register')">Register</div>
                            </div>

                            <div id="loginTab" class="tab-content active">
                                <form id="loginForm">
                                    <div class="form-group">
                                        <label class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Password</label>
                                        <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Role</label>
                                        <select class="form-control" id="loginRole" required>
                                            <option value="student">Student</option>
                                            <option value="faculty">Faculty</option>
                                            <option value="admin">Administrator</option>
                                            <option value="xeroxadmin">Xerox Admin</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Secret Key</label>
                                        <input type="password" class="form-control" id="loginSecretKey" placeholder="Enter secret key for your role" required>
                                        <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
                                            Student: sonastudent | Faculty: sona@faculty100 | Admin: sona-admin@ | Xerox Admin: sona@xerox69
                                        </small>
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                                        <i class="fas fa-sign-in-alt"></i>
                                        Sign In
                                    </button>
                                </form>
                            </div>

                            <div id="registerTab" class="tab-content">
                                <form id="registerForm">
                                    <div class="form-group">
                                        <label class="form-label">Full Name</label>
                                        <input type="text" class="form-control" id="registerName" placeholder="Enter your full name" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="registerEmail" placeholder="Enter your email" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Password</label>
                                        <input type="password" class="form-control" id="registerPassword" placeholder="Create a password (min. 6 characters)" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Role</label>
                                        <select class="form-control" id="registerRole" required>
                                            <option value="">Select your role</option>
                                            <option value="student">Student</option>
                                            <option value="faculty">Faculty</option>
                                            <option value="admin">Administrator</option>
                                            <option value="xeroxadmin">Xerox Admin</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="departmentField">
                                        <label class="form-label">Department</label>
                                        <select class="form-control" id="registerDepartment">
                                            <option value="CSE">Computer Science Engineering (CSE)</option>
                                            <option value="AIML">Artificial Intelligence & Machine Learning (AIML)</option>
                                            <option value="IT">Information Technology (IT)</option>
                                            <option value="AID">Artificial Intelligence & Data Science (AID)</option>
                                            <option value="CIVIL">Civil Engineering (CIVIL)</option>
                                            <option value="MBA">Business Administration (MBA)</option>
                                            <option value="EEE">Electrical & Electronics Engineering (EEE)</option>
                                            <option value="ECE">Electronics & Communication Engineering (ECE)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">WhatsApp Number</label>
                                        <input type="tel" class="form-control" id="registerWhatsApp" placeholder="Enter your WhatsApp number" required>
                                        <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
                                            Please enter your WhatsApp number for order updates and notifications
                                        </small>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Secret Key</label>
                                        <input type="password" class="form-control" id="registerSecretKey" placeholder="Enter secret key for your role" required>
                                        <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
                                            Student: sonastudent | Faculty: sona@faculty100 | Admin: sona-admin@ | Xerox Admin: sona@xerox69
                                        </small>
                                    </div>
                                    <button type="submit" class="btn btn-success" style="width: 100%;">
                                        <i class="fas fa-user-plus"></i>
                                        Create Account
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                `;

                // Form event listeners
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    App.handleLogin();
                });

                document.getElementById('registerForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    App.handleRegister();
                });

                // Role change handler
                document.getElementById('registerRole').addEventListener('change', (e) => {
                    const deptField = document.getElementById('departmentField');
                    deptField.style.display = e.target.value === 'xeroxadmin' ? 'none' : 'block';
                });
            }

            static switchTab(tabName) {
                // Update tabs
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                document.querySelector(`.tab[onclick="App.switchTab('${tabName}')"]`).classList.add('active');
                document.getElementById(tabName + 'Tab').classList.add('active');
            }

            static async handleLogin() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const role = document.getElementById('loginRole').value;
                const secretKey = document.getElementById('loginSecretKey').value;
                
                if (authSystem && typeof authSystem.login === 'function') {
                    await authSystem.login(email, password, role, secretKey);
                } else {
                    Utils.showNotification("System not ready. Please wait...", "error");
                }
            }

            static async handleRegister() {
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const role = document.getElementById('registerRole').value;
                const department = document.getElementById('registerDepartment').value;
                const whatsappNumber = document.getElementById('registerWhatsApp').value;
                const secretKey = document.getElementById('registerSecretKey').value;

                const userData = { 
                    fullName: name, 
                    department: role === 'xeroxadmin' ? 'Xerox Shop' : department,
                    whatsappNumber: whatsappNumber,
                    secretKey: secretKey
                };
                
                if (authSystem && typeof authSystem.register === 'function') {
                    await authSystem.register(email, password, role, userData);
                } else {
                    Utils.showNotification("System not ready. Please wait...", "error");
                }
            }

            static showDashboard() {
                if (!authSystem || !authSystem.userData) {
                    console.error("Auth system not ready");
                    Utils.showNotification("System initializing, please wait...", "info");
                    return;
                }

                const user = authSystem.userData;
                const isStudent = user.role === 'student';
                const isFaculty = user.role === 'faculty';
                const isAdmin = user.role === 'admin';
                const isXeroxAdmin = user.role === 'xeroxadmin';

                const app = document.getElementById('app');
                app.innerHTML = `
                    <div class="app-container">
                        <!-- Sidebar -->
                        <div class="sidebar">
                            <div class="sidebar-header">
                                <div class="logo">CAMPUS PORTAL</div>
                                <div class="logo-subtitle">Learning Management System</div>
                            </div>
                            <div class="nav-links">
                                <a class="nav-item ${App.currentView === 'dashboard' ? 'active' : ''}" onclick="App.showView('dashboard')">
                                    <i class="fas fa-home"></i>
                                    Dashboard
                                </a>
                                ${isStudent ? `
                                    <a class="nav-item ${App.currentView === 'materials' ? 'active' : ''}" onclick="App.showView('materials')">
                                        <i class="fas fa-books"></i>
                                        Study Materials
                                    </a>
                                    <a class="nav-item ${App.currentView === 'classrooms' ? 'active' : ''}" onclick="App.showView('classrooms')">
                                        <i class="fas fa-door-open"></i>
                                        Find Classrooms
                                    </a>
                                    <a class="nav-item ${App.currentView === 'faculty-offices' ? 'active' : ''}" onclick="App.showView('faculty-offices')">
                                        <i class="fas fa-user-tie"></i>
                                        Faculty Offices
                                    </a>
                                    <a class="nav-item ${App.currentView === 'print-service' ? 'active' : ''}" onclick="App.showView('print-service')">
                                        <i class="fas fa-print"></i>
                                        Print Service
                                    </a>
                                    <a class="nav-item ${App.currentView === 'my-orders' ? 'active' : ''}" onclick="App.showView('my-orders')">
                                        <i class="fas fa-receipt"></i>
                                        My Print Orders
                                    </a>
                                ` : ''}
                                ${isFaculty ? `
                                    <a class="nav-item ${App.currentView === 'upload' ? 'active' : ''}" onclick="App.showView('upload')">
                                        <i class="fas fa-upload"></i>
                                        Upload Materials
                                    </a>
                                    <a class="nav-item ${App.currentView === 'manage-materials' ? 'active' : ''}" onclick="App.showView('manage-materials')">
                                        <i class="fas fa-cog"></i>
                                        Manage Materials
                                    </a>
                                ` : ''}
                                ${isAdmin ? `
                                    <a class="nav-item ${App.currentView === 'classrooms' ? 'active' : ''}" onclick="App.showView('classrooms')">
                                        <i class="fas fa-door-open"></i>
                                        Manage Classrooms
                                    </a>
                                    <a class="nav-item ${App.currentView === 'faculty-offices' ? 'active' : ''}" onclick="App.showView('faculty-offices')">
                                        <i class="fas fa-user-tie"></i>
                                        Faculty Offices
                                    </a>
                                ` : ''}
                                ${isXeroxAdmin ? `
                                    <a class="nav-item ${App.currentView === 'xerox-admin' ? 'active' : ''}" onclick="App.showView('xerox-admin')">
                                        <i class="fas fa-print"></i>
                                        Xerox Admin
                                    </a>
                                ` : ''}
                                <a class="nav-item" onclick="logout()">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>

                        <!-- Main Content -->
                        <div class="main-content">
                            <!-- Top Navigation -->
                            <div class="top-nav">
                                <h2>Welcome back, ${user.fullName || 'User'}!</h2>
                                <div class="user-info">
                                    <div class="user-avatar">${Utils.getInitials(user.fullName)}</div>
                                    <div>
                                        <div style="font-weight: 600;">${user.fullName || 'User'}</div>
                                        <div style="font-size: 0.9rem; color: #6c757d; text-transform: capitalize;">
                                            ${user.role} ‚Ä¢ ${user.department || 'N/A'}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Content Area -->
                            <div class="content">
                                ${App.renderCurrentView()}
                            </div>
                        </div>
                    </div>
                `;

                // Initialize the appropriate dashboard with safety checks
                setTimeout(() => {
                    try {
                        if (isStudent && studentDashboard && typeof studentDashboard.init === 'function') {
                            studentDashboard.init();
                        } else if (isFaculty && facultyDashboard && typeof facultyDashboard.init === 'function') {
                            facultyDashboard.init();
                        } else if (isAdmin && adminDashboard && typeof adminDashboard.init === 'function') {
                            adminDashboard.init();
                        } else if (isXeroxAdmin && xeroxAdminDashboard && typeof xeroxAdminDashboard.init === 'function') {
                            xeroxAdminDashboard.init();
                        }
                    } catch (error) {
                        console.error('Error initializing dashboard:', error);
                        Utils.showNotification('Error loading dashboard features', 'error');
                    }
                }, 100);
            }

            static showView(view) {
                App.currentView = view;
                App.showDashboard();
            }

            static renderCurrentView() {
                const user = authSystem.userData;
                const isStudent = user.role === 'student';
                const isFaculty = user.role === 'faculty';
                const isAdmin = user.role === 'admin';
                const isXeroxAdmin = user.role === 'xeroxadmin';

                switch(App.currentView) {
                    case 'dashboard':
                        return App.renderDashboard();
                    case 'materials':
                        if (isStudent) return App.renderStudentMaterials();
                        break;
                    case 'upload':
                        if (isFaculty) return App.renderFacultyUpload();
                        break;
                    case 'manage-materials':
                        if (isFaculty) return App.renderFacultyManageMaterials();
                        break;
                    case 'classrooms':
                        if (isStudent) return App.renderStudentClassrooms();
                        if (isAdmin) return App.renderClassroomManagement();
                        break;
                    case 'faculty-offices':
                        if (isStudent) return App.renderStudentFacultyOffices();
                        if (isAdmin) return App.renderFacultyOfficeManagement();
                        break;
                    case 'print-service':
                        if (isStudent) return App.renderPrintService();
                        break;
                    case 'my-orders':
                        if (isStudent) return App.renderMyOrders();
                        break;
                    case 'xerox-admin':
                        if (isXeroxAdmin) return App.renderXeroxAdmin();
                        break;
                    default:
                        return App.renderDashboard();
                }
                
                return App.renderDashboard();
            }

            static renderDashboard() {
                const user = authSystem.userData;
                const isStudent = user.role === 'student';
                const isFaculty = user.role === 'faculty';
                const isAdmin = user.role === 'admin';
                const isXeroxAdmin = user.role === 'xeroxadmin';

                let dashboardContent = '';
                
                if (isStudent) {
                    dashboardContent = `
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-book-open"></i>
                                </div>
                                <div class="stat-number" id="materialCount">0</div>
                                <div class="stat-label">Available Materials</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-door-open"></i>
                                </div>
                                <div class="stat-number" id="classroomCount">0</div>
                                <div class="stat-label">Classrooms</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="stat-number" id="facultyCount">0</div>
                                <div class="stat-label">Faculty Offices</div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <i class="fas fa-compass"></i>
                                    Quick Access
                                </h2>
                            </div>
                            <div style="padding: 1rem 0; display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="App.showView('materials')">
                                    <i class="fas fa-books"></i>
                                    Study Materials
                                </button>
                                <button class="btn btn-success" onclick="App.showView('classrooms')">
                                    <i class="fas fa-door-open"></i>
                                    Find Classrooms
                                </button>
                                <button class="btn btn-info" onclick="App.showView('faculty-offices')">
                                    <i class="fas fa-user-tie"></i>
                                    Faculty Offices
                                </button>
                                <button class="btn btn-warning" onclick="App.showView('print-service')">
                                    <i class="fas fa-print"></i>
                                    Print Service
                                </button>
                                <button class="btn btn-outline" onclick="App.showView('my-orders')">
                                    <i class="fas fa-receipt"></i>
                                    My Orders
                                </button>
                            </div>
                        </div>
                    `;
                } else if (isFaculty) {
                    dashboardContent = `
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <div class="stat-number" id="uploadedMaterials">0</div>
                                <div class="stat-label">Materials Uploaded</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-download"></i>
                                </div>
                                <div class="stat-number" id="totalDownloads">0</div>
                                <div class="stat-label">Total Downloads</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-number" id="studentCount">0</div>
                                <div class="stat-label">Students in Department</div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <i class="fas fa-chart-line"></i>
                                    Quick Actions
                                </h2>
                            </div>
                            <div style="padding: 1rem 0;">
                                <button class="btn btn-primary" onclick="App.showView('upload')">
                                    <i class="fas fa-upload"></i>
                                    Upload New Material
                                </button>
                                <button class="btn btn-success" onclick="App.showView('manage-materials')">
                                    <i class="fas fa-cog"></i>
                                    Manage Materials
                                </button>
                            </div>
                        </div>
                    `;
                } else if (isAdmin) {
                    dashboardContent = `
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-door-open"></i>
                                </div>
                                <div class="stat-number" id="classroomCount">0</div>
                                <div class="stat-label">Classrooms</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="stat-number" id="facultyOfficeCount">0</div>
                                <div class="stat-label">Faculty Offices</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-number" id="totalUsers">0</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <i class="fas fa-cogs"></i>
                                    Admin Quick Actions
                                </h2>
                            </div>
                            <div style="padding: 1rem 0; display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="App.showView('classrooms')">
                                    <i class="fas fa-door-open"></i>
                                    Manage Classrooms
                                </button>
                                <button class="btn btn-success" onclick="App.showView('faculty-offices')">
                                    <i class="fas fa-user-tie"></i>
                                    Manage Faculty Offices
                                </button>
                            </div>
                        </div>
                    `;
                } else if (isXeroxAdmin) {
                    dashboardContent = `
                        <div id="xeroxAdminStats"></div>
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <i class="fas fa-cogs"></i>
                                    Xerox Admin
                                </h2>
                            </div>
                            <div style="padding: 1rem 0; display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="App.showView('xerox-admin')">
                                    <i class="fas fa-list"></i>
                                    View All Orders
                                </button>
                            </div>
                        </div>
                    `;
                }

                return dashboardContent;
            }

            static renderStudentMaterials() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-books"></i>
                                Study Materials
                            </h2>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="materialSearch" placeholder="Search materials by title or description...">
                            </div>
                            <div class="filter-options">
                                <select class="filter-select" id="semesterFilter">
                                    <option value="">All Semesters</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                        </div>

                        <div class="material-grid" id="studentMaterials">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>Loading materials...</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderStudentClassrooms() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-door-open"></i>
                                Find Classrooms
                            </h2>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="classroomSearch" placeholder="Search by room number, building, floor, or description...">
                            </div>
                            <div class="filter-options">
                                <select class="filter-select" id="buildingFilter">
                                    <option value="">All Buildings</option>
                                </select>
                            </div>
                        </div>

                        <div class="location-grid" id="classroomsList">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>Loading classrooms...</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderStudentFacultyOffices() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-user-tie"></i>
                                Faculty Offices
                            </h2>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="facultySearch" placeholder="Search by faculty name, department, office hours, or subjects...">
                            </div>
                            <div class="filter-options">
                                <select class="filter-select" id="facultyDeptFilter">
                                    <option value="">All Departments</option>
                                    <option value="CSE">Computer Science Engineering</option>
                                    <option value="AIML">Artificial Intelligence & Machine Learning</option>
                                    <option value="IT">Information Technology</option>
                                    <option value="AID">Artificial Intelligence & Data Science</option>
                                    <option value="CIVIL">Civil Engineering</option>
                                    <option value="MBA">Business Administration</option>
                                    <option value="EEE">Electrical & Electronics Engineering</option>
                                    <option value="ECE">Electronics & Communication Engineering</option>
                                </select>
                            </div>
                        </div>

                        <div class="location-grid" id="facultyOfficesList">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>Loading faculty offices...</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderPrintService() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-print"></i>
                                Campus Print Service
                            </h2>
                            <div style="display: flex; gap: 1rem;">
                                <span class="department-badge">
                                    <i class="fas fa-graduation-cap"></i>
                                    Available for All Students
                                </span>
                            </div>
                        </div>
                        
                        <div class="print-service-box">
                            <form id="printServiceForm">
                                <!-- File upload section -->
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-file-pdf"></i>
                                        Upload PDF Document
                                    </label>
                                    <div class="file-upload-area">
                                        <input type="file" class="form-control" id="fileInput" accept=".pdf" required>
                                        <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
                                            <i class="fas fa-info-circle"></i>
                                            Only PDF files are accepted. The system will automatically count pages.
                                        </small>
                                    </div>
                                </div>
                                
                                <div id="fileInfo" class="hidden"></div>
                                
                                <!-- Print Service Icons -->
                                <div id="printIcons" class="hidden"></div>
                                
                                <!-- Print options -->
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-print"></i>
                                        Print Type
                                    </label>
                                    <select class="form-control" id="printType">
                                        <option value="single_bw">Single Side B/W (‚Çπ1 per page)</option>
                                        <option value="both_bw">Both Side B/W (‚Çπ1.5 per page)</option>
                                        <option value="single_color">Single Side Color (‚Çπ6 per page)</option>
                                        <option value="both_color">Both Side Color (‚Çπ10 per page)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-copy"></i>
                                        Number of Copies
                                    </label>
                                    <input type="number" class="form-control" id="printCopies" 
                                           min="1" value="1" required>
                                </div>
                                
                                <button type="button" class="btn btn-primary" onclick="studentDashboard.calculateAmount()">
                                    <i class="fas fa-calculator"></i>
                                    Calculate Amount
                                </button>
                                
                                <div id="priceBreakdown" class="hidden"></div>
                                <div class="amount-display" id="amountText"></div>
                                <div id="paymentDiv"></div>
                            </form>
                            
                            <div id="qrContainer" class="hidden">
                                <div class="qr-container">
                                    <h4><i class="fas fa-qrcode"></i> Scan to Pay</h4>
                                    <div id="qrCode" class="qr-code"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderMyOrders() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-receipt"></i>
                                My Print Orders
                            </h2>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="orderSearch" placeholder="Search by transaction ID or file name...">
                            </div>
                            <div class="filter-options">
                                <input type="date" class="filter-select" id="orderDateFilter" placeholder="Filter by date">
                            </div>
                        </div>

                        <div id="myOrdersList">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>Loading your orders...</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderXeroxAdmin() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-print"></i>
                                Xerox Admin - All Orders
                            </h2>
                            <div style="display: flex; gap: 1rem;">
                                <span class="department-badge">
                                    <i class="fas fa-users"></i>
                                    All Departments
                                </span>
                            </div>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="xeroxOrderSearch" placeholder="Search by transaction ID, email, or file name...">
                            </div>
                            <div class="filter-options">
                                <select class="filter-select" id="xeroxOrderStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="paid">Paid</option>
                                    <option value="printed">Printed</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <select class="filter-select" id="xeroxDepartmentFilter">
                                    <option value="">All Departments</option>
                                    <option value="CSE">Computer Science Engineering</option>
                                    <option value="AIML">Artificial Intelligence & Machine Learning</option>
                                    <option value="IT">Information Technology</option>
                                    <option value="AID">Artificial Intelligence & Data Science</option>
                                    <option value="CIVIL">Civil Engineering</option>
                                    <option value="MBA">Business Administration</option>
                                    <option value="EEE">Electrical & Electronics Engineering</option>
                                    <option value="ECE">Electronics & Communication Engineering</option>
                                </select>
                                <input type="date" class="filter-select" id="xeroxOrderDateFilter" placeholder="Filter by date">
                            </div>
                        </div>

                        <div id="xeroxOrdersList">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>Loading orders...</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderFacultyUpload() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-upload"></i>
                                Upload Study Material
                            </h2>
                        </div>
                        
                        <div class="guide-card" style="background: #e8f4fd; border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;">
                            <h4 style="color: #4285f4; margin-bottom: 1rem;">
                                <i class="fab fa-google-drive"></i>
                                Google Drive Upload Guide
                            </h4>
                            <ol style="margin-left: 1.5rem; color: #5f6368;">
                                <li>Upload your PDF to Google Drive</li>
                                <li>Right-click ‚Üí Share ‚Üí General access ‚Üí "Anyone with the link"</li>
                                <li>Copy the shareable link and paste it below</li>
                                <li>Select "Students" to make it visible to students</li>
                            </ol>
                        </div>

                        <form id="materialUploadForm">
                            <div class="form-group">
                                <label class="form-label">Material Title</label>
                                <input type="text" class="form-control" id="materialTitle" placeholder="e.g., Introduction to Programming" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="materialDescription" placeholder="Describe this study material..." rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Semester</label>
                                <select class="form-control" id="materialSemester" required>
                                    <option value="">Select Semester</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Google Drive Link</label>
                                <input type="url" class="form-control" id="driveLink" placeholder="https://drive.google.com/file/d/.../view" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Audience</label>
                                <select class="form-control" id="materialType" required>
                                    <option value="student">Students</option>
                                    <option value="faculty">Faculty Only</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-cloud-upload-alt"></i>
                                Publish Material
                            </button>
                        </form>
                    </div>
                `;
            }

            static renderFacultyManageMaterials() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-cog"></i>
                                Manage Materials
                            </h2>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="facultyMaterialSearch" placeholder="Search your materials by title or description...">
                            </div>
                        </div>

                        <div class="material-grid" id="facultyMaterials">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>Loading materials...</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderClassroomManagement() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-door-open"></i>
                                Classroom Management
                            </h2>
                        </div>
                        
                        <div class="guide-card" style="background: #e8f4fd; border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;">
                            <h4 style="color: #4285f4; margin-bottom: 1rem;">
                                <i class="fas fa-info-circle"></i>
                                Classroom Information Guide
                            </h4>
                            <p style="color: #5f6368;">
                                Add detailed classroom information to help students and faculty locate classrooms easily.
                                Include building, floor, location description, and Google Maps link for better navigation.
                            </p>
                        </div>

                        <form id="classroomForm">
                            <div class="form-group">
                                <label class="form-label">Room Number</label>
                                <input type="text" class="form-control" id="roomNumber" placeholder="e.g., 201" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Building</label>
                                <input type="text" class="form-control" id="building" placeholder="e.g., Main Building" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Floor</label>
                                <input type="text" class="form-control" id="floor" placeholder="e.g., First Floor" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Location Description</label>
                                <textarea class="form-control" id="locationDescription" placeholder="e.g., From the main entrance, left side 50 meters..." rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Capacity</label>
                                <input type="number" class="form-control" id="capacity" placeholder="e.g., 50">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Equipment</label>
                                <input type="text" class="form-control" id="equipment" placeholder="e.g., Projector, Whiteboard, Computers">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Google Maps Link (Optional)</label>
                                <input type="url" class="form-control" id="mapLink" placeholder="https://maps.google.com/?q=Your+Location">
                                <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
                                    Students can click this link to open the location directly in Google Maps
                                </small>
                            </div>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-plus"></i>
                                Add Classroom
                            </button>
                        </form>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-list"></i>
                                All Classrooms
                            </h2>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="adminClassroomSearch" placeholder="Search classrooms...">
                            </div>
                        </div>
                        
                        <div class="location-grid" id="classroomsList">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>Loading classrooms...</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderFacultyOfficeManagement() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-user-tie"></i>
                                Faculty Office Management
                            </h2>
                        </div>
                        
                        <div class="guide-card" style="background: #e8f4fd; border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;">
                            <h4 style="color: #4285f4; margin-bottom: 1rem;">
                                <i class="fas fa-info-circle"></i>
                                Faculty Office Information Guide
                            </h4>
                            <p style="color: #5f6368;">
                                Add faculty office details including location, office hours, subjects taught, and contact information.
                                Include Google Maps link to help students find the office easily.
                            </p>
                        </div>

                        <form id="facultyOfficeForm">
                            <div class="form-group">
                                <label class="form-label">Faculty Name</label>
                                <input type="text" class="form-control" id="facultyName" placeholder="e.g., Dr. John Smith" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <select class="form-control" id="officeDepartment" required>
                                    <option value="CSE">Computer Science Engineering</option>
                                    <option value="AIML">Artificial Intelligence & Machine Learning</option>
                                    <option value="IT">Information Technology</option>
                                    <option value="AID">Artificial Intelligence & Data Science</option>
                                    <option value="CIVIL">Civil Engineering</option>
                                    <option value="MBA">Business Administration</option>
                                    <option value="EEE">Electrical & Electronics Engineering</option>
                                    <option value="ECE">Electronics & Communication Engineering</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Office Location</label>
                                <textarea class="form-control" id="officeLocation" placeholder="e.g., Main Building, Second Floor, Room 215" rows="2" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Office Hours</label>
                                <input type="text" class="form-control" id="officeHours" placeholder="e.g., Mon-Wed 10:00 AM - 12:00 PM" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Subjects Taught</label>
                                <input type="text" class="form-control" id="subjects" placeholder="e.g., Data Structures, Algorithms">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Contact Information</label>
                                <input type="text" class="form-control" id="contactInfo" placeholder="e.g., john.smith@university.edu, Ext. 1234">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Google Maps Link (Optional)</label>
                                <input type="url" class="form-control" id="officeMapLink" placeholder="https://maps.google.com/?q=Your+Location">
                                <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
                                    Students can click this link to open the location directly in Google Maps
                                </small>
                            </div>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-plus"></i>
                                Add Faculty Office
                            </button>
                        </form>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-list"></i>
                                All Faculty Offices
                            </h2>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="adminFacultySearch" placeholder="Search faculty offices...">
                            </div>
                        </div>
                        
                        <div class="location-grid" id="facultyOfficesList">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>Loading faculty offices...</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // =============================================
        // APPLICATION INITIALIZATION
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                console.log("üîÑ Initializing Campus Portal...");
                
                // Wait for Firebase to be ready
                if (!firebaseInitialized) {
                    console.log("‚è≥ Waiting for Firebase initialization...");
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                // Initialize managers in correct order
                authSystem = new AuthSystem();
                await new Promise(resolve => setTimeout(resolve, 100)); // Small delay
                
                dbManager = new DatabaseManager();
                studentDashboard = new StudentDashboard();
                facultyDashboard = new FacultyDashboard();
                adminDashboard = new AdminDashboard();
                xeroxAdminDashboard = new XeroxAdminDashboard();
                
                console.log("‚úÖ All components initialized successfully");
                
                // Setup event listeners
                setupEventListeners();
                
                // Hide loading screen
                setTimeout(() => {
                    Utils.hideElement('loadingScreen');
                    console.log("üöÄ Campus Portal is ready!");
                }, 1000);
                
            } catch (error) {
                console.error("‚ùå Error during initialization:", error);
                Utils.showNotification("Failed to initialize application. Please refresh the page.", "error");
                
                // Still hide loading screen to show error
                setTimeout(() => {
                    Utils.hideElement('loadingScreen');
                }, 2000);
            }
        }

        function setupEventListeners() {
            // Use event delegation for dynamic elements
            document.addEventListener('change', function(e) {
                if (e.target && e.target.id === 'fileInput') {
                    if (studentDashboard && typeof studentDashboard.handleFileSelect === 'function') {
                        studentDashboard.handleFileSelect(e);
                    }
                }
            });
        }

        // Safe global function for logout
        function logout() {
            if (authSystem && typeof authSystem.logout === 'function') {
                authSystem.logout();
            } else {
                Utils.showNotification("System not ready. Please try again.", "error");
            }
        }
    </script>
</body>
</html>